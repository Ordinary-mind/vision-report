var Le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}class xe{constructor(e,t=""){typeof e=="string"?(this.el=document.createElement(e),this.el.className=t):this.el=e,this.data={}}data(e,t){return t!==void 0?(this.data[e]=t,this):this.data[e]}on(e,t){const[i,...s]=e.split(".");let r=i;return r==="mousewheel"&&/Firefox/i.test(window.navigator.userAgent)&&(r="DOMMouseScroll"),this.el.addEventListener(r,l=>{t(l);for(let o=0;o<s.length;o+=1){const a=s[o];if(a==="left"&&l.button!==0||a==="right"&&l.button!==2)return;a==="stop"&&l.stopPropagation()}}),this}offset(e){if(e!==void 0)return Object.keys(e).forEach(l=>{this.css(l,`${e[l]}px`)}),this;const{offsetTop:t,offsetLeft:i,offsetHeight:s,offsetWidth:r}=this.el;return{top:t,left:i,height:s,width:r}}scroll(e){const{el:t}=this;return e!==void 0&&(e.left!==void 0&&(t.scrollLeft=e.left),e.top!==void 0&&(t.scrollTop=e.top)),{left:t.scrollLeft,top:t.scrollTop}}box(){return this.el.getBoundingClientRect()}parent(){return new xe(this.el.parentNode)}children(...e){return arguments.length===0?this.el.childNodes:(e.forEach(t=>this.child(t)),this)}removeChild(e){this.el.removeChild(e)}child(e){let t=e;return typeof e=="string"?t=document.createTextNode(e):e instanceof xe&&(t=e.el),this.el.appendChild(t),this}contains(e){return this.el.contains(e)}className(e){return e!==void 0?(this.el.className=e,this):this.el.className}addClass(e){return this.el.classList.add(e),this}hasClass(e){return this.el.classList.contains(e)}removeClass(e){return this.el.classList.remove(e),this}toggle(e="active"){return this.toggleClass(e)}toggleClass(e){return this.el.classList.toggle(e)}active(e=!0,t="active"){return e?this.addClass(t):this.removeClass(t),this}checked(e=!0){return this.active(e,"checked"),this}disabled(e=!0){return e?this.addClass("disabled"):this.removeClass("disabled"),this}attr(e,t){if(t!==void 0)this.el.setAttribute(e,t);else{if(typeof e=="string")return this.el.getAttribute(e);Object.keys(e).forEach(i=>{this.el.setAttribute(i,e[i])})}return this}removeAttr(e){return this.el.removeAttribute(e),this}html(e){return e!==void 0?(this.el.innerHTML=e,this):this.el.innerHTML}val(e){return e!==void 0?(this.el.value=e,this):this.el.value}focus(){this.el.focus()}cssRemoveKeys(...e){return e.forEach(t=>this.el.style.removeProperty(t)),this}css(e,t){return t===void 0&&typeof e!="string"?(Object.keys(e).forEach(i=>{this.el.style[i]=e[i]}),this):t!==void 0?(this.el.style[e]=t,this):this.el.style[e]}computedStyle(){return window.getComputedStyle(this.el,null)}show(){return this.css("display","block"),this}hide(){return this.css("display","none"),this}}const b=(n,e="")=>new xe(n,e),pe=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function Ri(n){let e="",t=n;for(;t>=pe.length;)t/=pe.length,t-=1,e+=pe[parseInt(t,10)%pe.length];const i=n%pe.length;return e+=pe[i],e}function Js(n){let e=0;for(let t=0;t<n.length-1;t+=1){const i=n.charCodeAt(t)-65,s=n.length-1-t;e+=pe.length**s+pe.length*i}return e+=n.charCodeAt(n.length-1)-65,e}function me(n){let e="",t="";for(let i=0;i<n.length;i+=1)n.charAt(i)>="0"&&n.charAt(i)<="9"?t+=n.charAt(i):e+=n.charAt(i);return[Js(e),parseInt(t,10)-1]}function he(n,e){return`${Ri(n)}${e+1}`}function Ae(n,e,t,i=()=>!0){if(e===0&&t===0)return n;const[s,r]=me(n);return i(s,r)?he(s+e,r+t):n}class j{constructor(e,t,i,s,r=0,l=0){this.sri=e,this.sci=t,this.eri=i,this.eci=s,this.w=r,this.h=l}set(e,t,i,s){this.sri=e,this.sci=t,this.eri=i,this.eci=s}multiple(){return this.eri-this.sri>0||this.eci-this.sci>0}includes(...e){let[t,i]=[0,0];e.length===1?[i,t]=me(e[0]):e.length===2&&([t,i]=e);const{sri:s,sci:r,eri:l,eci:o}=this;return s<=t&&t<=l&&r<=i&&i<=o}each(e,t=()=>!0){const{sri:i,sci:s,eri:r,eci:l}=this;for(let o=i;o<=r;o+=1)if(t(o))for(let a=s;a<=l;a+=1)e(o,a)}contains(e){return this.sri<=e.sri&&this.sci<=e.sci&&this.eri>=e.eri&&this.eci>=e.eci}within(e){return this.sri>=e.sri&&this.sci>=e.sci&&this.eri<=e.eri&&this.eci<=e.eci}disjoint(e){return this.sri>e.eri||this.sci>e.eci||e.sri>this.eri||e.sci>this.eci}intersects(e){return this.sri<=e.eri&&this.sci<=e.eci&&e.sri<=this.eri&&e.sci<=this.eci}union(e){const{sri:t,sci:i,eri:s,eci:r}=this;return new j(e.sri<t?e.sri:t,e.sci<i?e.sci:i,e.eri>s?e.eri:s,e.eci>r?e.eci:r)}difference(e){const t=[],i=(p,y,x,T)=>{t.push(new j(p,y,x,T))},{sri:s,sci:r,eri:l,eci:o}=this,a=e.sri-s,f=e.sci-r,u=l-e.eri,h=o-e.eci;return a>0?(i(s,r,e.sri-1,o),u>0?(i(e.eri+1,r,l,o),f>0&&i(e.sri,r,e.eri,e.sci-1),h>0&&i(e.sri,e.eci+1,e.eri,o)):(f>0&&i(e.sri,r,l,e.sci-1),h>0&&i(e.sri,e.eci+1,l,o))):u>0&&(i(e.eri+1,r,l,o),f>0&&i(s,r,e.eri,e.sci-1),h>0&&i(s,e.eci+1,e.eri,o)),f>0?(i(s,r,l,e.sci-1),h>0?(i(s,e.eri+1,l,o),a>0&&i(s,e.sci,e.sri-1,e.eci),u>0&&i(e.sri+1,e.sci,l,e.eci)):(a>0&&i(s,e.sci,e.sri-1,o),u>0&&i(e.sri+1,e.sci,l,o))):h>0&&(i(l,e.eci+1,l,o),a>0&&i(s,r,e.sri-1,e.eci),u>0&&i(e.eri+1,r,l,e.eci)),t}size(){return[this.eri-this.sri+1,this.eci-this.sci+1]}toString(){const{sri:e,sci:t,eri:i,eci:s}=this;let r=he(t,e);return this.multiple()&&(r=`${r}:${he(s,i)}`),r}clone(){const{sri:e,sci:t,eri:i,eci:s,w:r,h:l}=this;return new j(e,t,i,s,r,l)}equals(e){return this.eri===e.eri&&this.eci===e.eci&&this.sri===e.sri&&this.sci===e.sci}static valueOf(e){const t=e.split(":"),[i,s]=me(t[0]);let[r,l]=[s,i];return t.length>1&&([l,r]=me(t[1])),new j(s,i,r,l)}}let Qs=class{constructor(){this.range=new j(0,0,0,0),this.ri=0,this.ci=0}multiple(){return this.range.multiple()}setIndexes(e,t){this.ri=e,this.ci=t}size(){return this.range.size()}};class en{constructor(){this.x=0,this.y=0,this.ri=0,this.ci=0}}class tn{constructor(){this.undoItems=[],this.redoItems=[]}add(e){this.undoItems.push(JSON.stringify(e)),this.redoItems=[]}canUndo(){return this.undoItems.length>0}canRedo(){return this.redoItems.length>0}undo(e,t){const{undoItems:i,redoItems:s}=this;this.canUndo()&&(s.push(JSON.stringify(e)),t(JSON.parse(i.pop())))}redo(e,t){const{undoItems:i,redoItems:s}=this;this.canRedo()&&(i.push(JSON.stringify(e)),t(JSON.parse(s.pop())))}}class sn{constructor(){this.range=null,this.state="clear"}copy(e){return this.range=e,this.state="copy",this}cut(e){return this.range=e,this.state="cut",this}isCopy(){return this.state==="copy"}isCut(){return this.state==="cut"}isClear(){return this.state==="clear"}clear(){this.range=null,this.state="clear"}}class ni{constructor(e,t,i){this.ci=e,this.operator=t,this.value=i}set(e,t){this.operator=e,this.value=t}includes(e){const{operator:t,value:i}=this;return t==="all"?!0:t==="in"?i.includes(e):!1}vlength(){const{operator:e,value:t}=this;return e==="in"?t.length:0}getData(){const{ci:e,operator:t,value:i}=this;return{ci:e,operator:t,value:i}}}class ri{constructor(e,t){this.ci=e,this.order=t}asc(){return this.order==="asc"}desc(){return this.order==="desc"}}class nn{constructor(){this.ref=null,this.filters=[],this.sort=null}setData({ref:e,filters:t,sort:i}){e!=null&&(this.ref=e,this.filters=t.map(s=>new ni(s.ci,s.operator,s.value)),i&&(this.sort=new ri(i.ci,i.order)))}getData(){if(this.active()){const{ref:e,filters:t,sort:i}=this;return{ref:e,filters:t.map(s=>s.getData()),sort:i}}return{}}addFilter(e,t,i){const s=this.getFilter(e);s==null?this.filters.push(new ni(e,t,i)):s.set(t,i)}setSort(e,t){this.sort=t?new ri(e,t):null}includes(e,t){return this.active()?this.hrange().includes(e,t):!1}getSort(e){const{sort:t}=this;return t&&t.ci===e?t:null}getFilter(e){const{filters:t}=this;for(let i=0;i<t.length;i+=1)if(t[i].ci===e)return t[i];return null}filteredRows(e){const t=new Set,i=new Set;if(this.active()){const{sri:s,eri:r}=this.range(),{filters:l}=this;for(let o=s+1;o<=r;o+=1)for(let a=0;a<l.length;a+=1){const f=l[a],u=e(o,f.ci),h=u?u.text:"";if(f.includes(h))i.add(o);else{t.add(o);break}}}return{rset:t,fset:i}}items(e,t){const i={};if(this.active()){const{sri:s,eri:r}=this.range();for(let l=s+1;l<=r;l+=1){const o=t(l,e);if(o!==null&&!/^\s*$/.test(o.text)){const a=o.text,f=(i[a]||0)+1;i[a]=f}else i[""]=(i[""]||0)+1}}return i}range(){return j.valueOf(this.ref)}hrange(){const e=this.range();return e.eri=e.sri,e}clear(){this.ref=null,this.filters=[],this.sort=null}active(){return this.ref!==null}}class It{constructor(e=[]){this._=e}forEach(e){this._.forEach(e)}deleteWithin(e){this._=this._.filter(t=>!t.within(e))}getFirstIncludes(e,t){for(let i=0;i<this._.length;i+=1){const s=this._[i];if(s.includes(e,t))return s}return null}filterIntersects(e){return new It(this._.filter(t=>t.intersects(e)))}intersects(e){for(let t=0;t<this._.length;t+=1)if(this._[t].intersects(e))return!0;return!1}union(e){let t=e;return this._.forEach(i=>{i.intersects(t)&&(t=i.union(t))}),t}add(e){this.deleteWithin(e),this._.push(e)}shift(e,t,i,s){this._.forEach(r=>{const{sri:l,sci:o,eri:a,eci:f}=r,u=r;e==="row"?l>=t?(u.sri+=i,u.eri+=i):l<t&&t<=a&&(u.eri+=i,s(l,o,i,0)):e==="column"&&(o>=t?(u.sci+=i,u.eci+=i):o<t&&t<=f&&(u.eci+=i,s(l,o,0,i)))})}move(e,t,i){this._.forEach(s=>{const r=s;r.within(e)&&(r.eri+=t,r.sri+=t,r.sci+=i,r.eci+=i)})}setData(e){return this._=e.map(t=>j.valueOf(t)),this}getData(){return this._.map(e=>e.toString())}}function rn(n){return JSON.parse(JSON.stringify(n))}const Ai=(n={},...e)=>(e.forEach(t=>{Object.keys(t).forEach(i=>{const s=t[i];typeof s=="string"||typeof s=="number"||typeof s=="boolean"?n[i]=s:typeof s!="function"&&!Array.isArray(s)&&s instanceof Object?(n[i]=n[i]||{},Ai(n[i],s)):n[i]=s})}),n);function bt(n,e){const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let i=0;i<t.length;i+=1){const s=t[i],r=n[s],l=e[s];if(l===void 0)return!1;if(typeof r=="string"||typeof r=="number"||typeof r=="boolean"){if(r!==l)return!1}else if(Array.isArray(r)){if(r.length!==l.length)return!1;for(let o=0;o<r.length;o+=1)if(!bt(r[o],l[o]))return!1}else if(typeof r!="function"&&!Array.isArray(r)&&r instanceof Object&&!bt(r,l))return!1}return!0}const ln=(n,e=t=>t)=>{let t=0,i=0;return Object.keys(n).forEach(s=>{t+=e(n[s],s),i+=1}),[t,i]};function on(n,e){const t=n[`${e}`];return delete n[`${e}`],t}function an(n,e,t,i,s,r){let l=t,o=i,a=n;for(;a<e&&!(l>s);a+=1)o=r(a),l+=o;return[a,l-o,o]}function cn(n,e,t){let i=0;for(let s=n;s<e;s+=1)i+=t(s);return i}function hn(n,e,t){for(let i=n;i<e;i+=1)t(i)}function fn(n,e){if(n.length===e.length){for(let t=0;t<n.length;t+=1)if(n[t]!==e[t])return!1}else return!1;return!0}function gt(n){const e=`${n}`;let t=0,i=!1;for(let s=0;s<e.length;s+=1)i===!0&&(t+=1),e.charAt(s)==="."&&(i=!0);return t}function we(n,e,t){if(Number.isNaN(e)||Number.isNaN(t))return e+n+t;const i=gt(e),s=gt(t),r=Number(e),l=Number(t);let o=0;if(n==="-")o=r-l;else if(n==="+")o=r+l;else if(n==="*")o=r*l;else if(n==="/")return o=r/l,gt(o)>5?o.toFixed(2):o;return o.toFixed(Math.max(i,s))}const ee={cloneDeep:rn,merge:(...n)=>Ai({},...n),equals:bt,arrayEquals:fn,sum:ln,rangeEach:hn,rangeSum:cn,rangeReduceIf:an,deleteProperty:on,numberCalc:we};class dn{constructor({len:e,height:t}){this._={},this.len=e,this.height=t}getHeight(e){if(this.isHide(e))return 0;const t=this.get(e);return t&&t.height?t.height:this.height}setHeight(e,t){const i=this.getOrNew(e);i.height=t}unhide(e){let t=e;for(;t>0&&(t-=1,this.isHide(t));)this.setHide(t,!1)}isHide(e){const t=this.get(e);return t&&t.hide}setHide(e,t){const i=this.getOrNew(e);t===!0?i.hide=!0:delete i.hide}setStyle(e,t){const i=this.getOrNew(e);i.style=t}sumHeight(e,t,i){return ee.rangeSum(e,t,s=>i&&i.has(s)?0:this.getHeight(s))}totalHeight(){return this.sumHeight(0,this.len)}get(e){return this._[e]}getOrNew(e){return this._[e]=this._[e]||{cells:{}},this._[e]}getCell(e,t){const i=this.get(e);return i!==void 0&&i.cells!==void 0&&i.cells[t]!==void 0?i.cells[t]:null}getCellMerge(e,t){const i=this.getCell(e,t);return i&&i.merge?i.merge:[0,0]}getCellOrNew(e,t){const i=this.getOrNew(e);return i.cells[t]=i.cells[t]||{},i.cells[t]}setCell(e,t,i,s="all"){const r=this.getOrNew(e);s==="all"?r.cells[t]=i:s==="text"?(r.cells[t]=r.cells[t]||{},r.cells[t].text=i.text):s==="format"&&(r.cells[t]=r.cells[t]||{},r.cells[t].style=i.style,i.merge&&(r.cells[t].merge=i.merge))}setCellText(e,t,i){const s=this.getCellOrNew(e,t);s.editable!==!1&&(s.text=i)}copyPaste(e,t,i,s=!1,r=()=>{}){const{sri:l,sci:o,eri:a,eci:f}=e,u=t.sri,h=t.sci,p=t.eri,y=t.eci,[x,T]=e.size(),[$,R]=t.size();let O=!0,z=0;(p<l||y<o)&&(O=!1,p<l?z=$:z=R);for(let N=l;N<=a;N+=1)if(this._[N]){for(let S=o;S<=f;S+=1)if(this._[N].cells&&this._[N].cells[S])for(let B=u;B<=p;B+=x)for(let F=h;F<=y;F+=T){const P=B+(N-l),U=F+(S-o),Y=ee.cloneDeep(this._[N].cells[S]);if(s&&Y&&Y.text&&Y.text.length>0){const{text:Z}=Y;let G=F-h+(B-u)+2;if(O||(G-=z+1),Z[0]==="=")Y.text=Z.replace(/[a-zA-Z]{1,3}\d+/g,J=>{let[re,ve]=[0,0];return l===u?re=G-1:ve=G-1,/^\d+$/.test(J)?J:Ae(J,re,ve)});else if(x<=1&&T>1&&(u>a||p<l)||T<=1&&x>1&&(h>f||y<o)||x<=1&&T<=1){const J=/[\\.\d]+$/.exec(Z);if(J!==null){const re=Number(J[0])+G-1;Y.text=Z.substring(0,J.index)+re}}}this.setCell(P,U,Y,i),r(P,U,Y)}}}cutPaste(e,t){const i={};this.each(s=>{this.eachCells(s,r=>{let l=parseInt(s,10),o=parseInt(r,10);e.includes(s,r)&&(l=t.sri+(l-e.sri),o=t.sci+(o-e.sci)),i[l]=i[l]||{cells:{}},i[l].cells[o]=this._[s].cells[r]})}),this._=i}paste(e,t){if(e.length<=0)return;const{sri:i,sci:s}=t;e.forEach((r,l)=>{const o=i+l;r.forEach((a,f)=>{const u=s+f;this.setCellText(o,u,a)})})}insert(e,t=1){const i={};this.each((s,r)=>{let l=parseInt(s,10);l>=e&&(l+=t,this.eachCells(s,(o,a)=>{a.text&&a.text[0]==="="&&(a.text=a.text.replace(/[a-zA-Z]{1,3}\d+/g,f=>Ae(f,0,t,(u,h)=>h>=e)))})),i[l]=r}),this._=i,this.len+=t}delete(e,t){const i=t-e+1,s={};this.each((r,l)=>{const o=parseInt(r,10);o<e?s[o]=l:r>t&&(s[o-i]=l,this.eachCells(r,(a,f)=>{f.text&&f.text[0]==="="&&(f.text=f.text.replace(/[a-zA-Z]{1,3}\d+/g,u=>Ae(u,0,-i,(h,p)=>p>t)))}))}),this._=s,this.len-=i}insertColumn(e,t=1){this.each((i,s)=>{const r={};this.eachCells(i,(l,o)=>{let a=parseInt(l,10);a>=e&&(a+=t,o.text&&o.text[0]==="="&&(o.text=o.text.replace(/[a-zA-Z]{1,3}\d+/g,f=>Ae(f,t,0,u=>u>=e)))),r[a]=o}),s.cells=r})}deleteColumn(e,t){const i=t-e+1;this.each((s,r)=>{const l={};this.eachCells(s,(o,a)=>{const f=parseInt(o,10);f<e?l[f]=a:f>t&&(l[f-i]=a,a.text&&a.text[0]==="="&&(a.text=a.text.replace(/[a-zA-Z]{1,3}\d+/g,u=>Ae(u,-i,0,h=>h>t))))}),r.cells=l})}deleteCells(e,t="all"){e.each((i,s)=>{this.deleteCell(i,s,t)})}deleteCell(e,t,i="all"){const s=this.get(e);if(s!==null){const r=this.getCell(e,t);r!==null&&r.editable!==!1&&(i==="all"?delete s.cells[t]:i==="text"?(r.text&&delete r.text,r.value&&delete r.value):i==="format"?(r.style!==void 0&&delete r.style,r.merge&&delete r.merge):i==="merge"&&r.merge&&delete r.merge)}}maxCell(){const e=Object.keys(this._),t=e[e.length-1],i=this._[t];if(i){const{cells:s}=i,r=Object.keys(s),l=r[r.length-1];return[parseInt(t,10),parseInt(l,10)]}return[0,0]}each(e){Object.entries(this._).forEach(([t,i])=>{e(t,i)})}eachCells(e,t){this._[e]&&this._[e].cells&&Object.entries(this._[e].cells).forEach(([i,s])=>{t(i,s)})}setData(e){e.len&&(this.len=e.len,delete e.len),this._=e}getData(){const{len:e}=this;return Object.assign({len:e},this._)}}class un{constructor({len:e,width:t,indexWidth:i,minWidth:s}){this._={},this.len=e,this.width=t,this.indexWidth=i,this.minWidth=s}setData(e){e.len&&(this.len=e.len,delete e.len),this._=e}getData(){const{len:e}=this;return Object.assign({len:e},this._)}getWidth(e){if(this.isHide(e))return 0;const t=this._[e];return t&&t.width?t.width:this.width}getOrNew(e){return this._[e]=this._[e]||{},this._[e]}setWidth(e,t){const i=this.getOrNew(e);i.width=t}unhide(e){let t=e;for(;t>0&&(t-=1,this.isHide(t));)this.setHide(t,!1)}isHide(e){const t=this._[e];return t&&t.hide}setHide(e,t){const i=this.getOrNew(e);t===!0?i.hide=!0:delete i.hide}setStyle(e,t){const i=this.getOrNew(e);i.style=t}sumWidth(e,t){return ee.rangeSum(e,t,i=>this.getWidth(i))}totalWidth(){return this.sumWidth(0,this.len)}}const gn={toolbar:{undo:"Undo",redo:"Redo",print:"Print",paintformat:"Paint format",clearformat:"Clear format",format:"Format",fontName:"Font",fontSize:"Font size",fontBold:"Font bold",fontItalic:"Font italic",underline:"Underline",strike:"Strike",color:"Text color",bgcolor:"Fill color",border:"Borders",merge:"Merge cells",align:"Horizontal align",valign:"Vertical align",textwrap:"Text wrapping",freeze:"Freeze cell",autofilter:"Filter",formula:"Functions",more:"More"},contextmenu:{copy:"Copy",cut:"Cut",paste:"Paste",pasteValue:"Paste values only",pasteFormat:"Paste format only",hide:"Hide",insertRow:"Insert row",insertColumn:"Insert column",deleteSheet:"Delete",deleteRow:"Delete row",deleteColumn:"Delete column",deleteCell:"Delete cell",deleteCellText:"Delete cell text",validation:"Data validations",cellprintable:"Enable export",cellnonprintable:"Disable export",celleditable:"Enable editing",cellnoneditable:"Disable editing"},print:{size:"Paper size",orientation:"Page orientation",orientations:["Landscape","Portrait"]},format:{normal:"Normal",text:"Plain Text",number:"Number",percent:"Percent",rmb:"RMB",usd:"USD",eur:"EUR",date:"Date",time:"Time",datetime:"Date time",duration:"Duration"},formula:{sum:"Sum",average:"Average",max:"Max",min:"Min",_if:"IF",and:"AND",or:"OR",concat:"Concat"},validation:{required:"it must be required",notMatch:"it not match its validation rule",between:"it is between {} and {}",notBetween:"it is not between {} and {}",notIn:"it is not in list",equal:"it equal to {}",notEqual:"it not equal to {}",lessThan:"it less than {}",lessThanEqual:"it less than or equal to {}",greaterThan:"it greater than {}",greaterThanEqual:"it greater than or equal to {}"},error:{pasteForMergedCell:"Unable to do this for merged cells"},calendar:{weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]},button:{next:"Next",cancel:"Cancel",remove:"Remove",save:"Save",ok:"OK"},sort:{desc:"Sort Z -> A",asc:"Sort A -> Z"},filter:{empty:"empty"},dataValidation:{mode:"Mode",range:"Cell Range",criteria:"Criteria",modeType:{cell:"Cell",column:"Colun",row:"Row"},type:{list:"List",number:"Number",date:"Date",phone:"Phone",email:"Email"},operator:{be:"between",nbe:"not betwwen",lt:"less than",lte:"less than or equal to",gt:"greater than",gte:"greater than or equal to",eq:"equal to",neq:"not equal to"}}};let yt=["en"];const Oi={en:gn};function li(n,e){if(e)for(const t of yt){if(!e[t])break;let i=e[t];const s=n.match(/(?:\\.|[^.])+/g);for(let r=0;r<s.length;r+=1){const l=s[r],o=i[l];if(!o)break;if(r===s.length-1)return o;i=o}}}function K(n){let e=li(n,Oi);return!e&&window&&window.x_spreadsheet&&window.x_spreadsheet.$messages&&(e=li(n,window.x_spreadsheet.$messages)),e||""}function L(n){return()=>K(n)}function zi(n,e,t=!1){t?yt=[n]:yt.unshift(n),e&&(Oi[n]=e)}const oi={phone:/^[1-9]\d{10}$/,email:/w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*/};function ne(n,e,...t){let i="";return n||(i=K(`validation.${e}`,...t)),[n,i]}class Ni{constructor(e,t,i,s){this.required=t,this.value=i,this.type=e,this.operator=s,this.message=""}parseValue(e){const{type:t}=this;return t==="date"?new Date(e):t==="number"?Number(e):e}equals(e){let t=this.type===e.type&&this.required===e.required&&this.operator===e.operator;return t&&(Array.isArray(this.value)?t=ee.arrayEquals(this.value,e.value):t=this.value===e.value),t}values(){return this.value.split(",")}validate(e){const{required:t,operator:i,value:s,type:r}=this;if(t&&/^\s*$/.test(e))return ne(!1,"required");if(/^\s*$/.test(e))return[!0];if(oi[r]&&!oi[r].test(e))return ne(!1,"notMatch");if(r==="list")return ne(this.values().includes(e),"notIn");if(i){const l=this.parseValue(e);if(i==="be"){const[o,a]=s;return ne(l>=this.parseValue(o)&&l<=this.parseValue(a),"between",o,a)}if(i==="nbe"){const[o,a]=s;return ne(l<this.parseValue(o)||l>this.parseValue(a),"notBetween",o,a)}if(i==="eq")return ne(l===this.parseValue(s),"equal",s);if(i==="neq")return ne(l!==this.parseValue(s),"notEqual",s);if(i==="lt")return ne(l<this.parseValue(s),"lessThan",s);if(i==="lte")return ne(l<=this.parseValue(s),"lessThanEqual",s);if(i==="gt")return ne(l>this.parseValue(s),"greaterThan",s);if(i==="gte")return ne(l>=this.parseValue(s),"greaterThanEqual",s)}return[!0]}}class Ge{constructor(e,t,i){this.refs=t,this.mode=e,this.validator=i}includes(e,t){const{refs:i}=this;for(let s=0;s<i.length;s+=1)if(j.valueOf(i[s]).includes(e,t))return!0;return!1}addRef(e){this.remove(j.valueOf(e)),this.refs.push(e)}remove(e){const t=[];this.refs.forEach(i=>{const s=j.valueOf(i);s.intersects(e)?s.difference(e).forEach(l=>t.push(l.toString())):t.push(i)}),this.refs=t}getData(){const{refs:e,mode:t,validator:i}=this,{type:s,required:r,operator:l,value:o}=i;return{refs:e,mode:t,type:s,required:r,operator:l,value:o}}static valueOf({refs:e,mode:t,type:i,required:s,operator:r,value:l}){return new Ge(t,e,new Ni(i,s,l,r))}}class pn{constructor(){this._=[],this.errors=new Map}getError(e,t){return this.errors.get(`${e}_${t}`)}validate(e,t,i){const s=this.get(e,t),r=`${e}_${t}`,{errors:l}=this;if(s!==null){const[o,a]=s.validator.validate(i);o?l.delete(r):l.set(r,a)}else l.delete(r);return!0}add(e,t,{type:i,required:s,value:r,operator:l}){const o=new Ni(i,s,r,l),a=this.getByValidator(o);a!==null?a.addRef(t):this._.push(new Ge(e,[t],o))}getByValidator(e){for(let t=0;t<this._.length;t+=1){const i=this._[t];if(i.validator.equals(e))return i}return null}get(e,t){for(let i=0;i<this._.length;i+=1){const s=this._[i];if(s.includes(e,t))return s}return null}remove(e){this.each(t=>{t.remove(e)})}each(e){this._.forEach(t=>e(t))}getData(){return this._.filter(e=>e.refs.length>0).map(e=>e.getData())}setData(e){this._=e.map(t=>Ge.valueOf(t))}}const mn={mode:"edit",view:{height:()=>document.documentElement.clientHeight,width:()=>document.documentElement.clientWidth},showGrid:!0,showToolbar:!0,showContextmenu:!0,showBottomBar:!0,row:{len:100,height:25},col:{len:26,width:100,indexWidth:60,minWidth:60},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Arial",size:10,bold:!1,italic:!1},format:"normal"}},vn=41,wn=41,ai=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);function ci(n,e,t=()=>{}){const{merges:i}=this,s=e.clone(),[r,l]=n.size(),[o,a]=e.size();return r>o&&(s.eri=e.sri+r-1),l>a&&(s.eci=e.sci+l-1),i.intersects(s)?(t(K("error.pasteForMergedCell")),!1):!0}function hi(n,e,t,i=!1){const{rows:s,merges:r}=this;(t==="all"||t==="format")&&(s.deleteCells(e,t),r.deleteWithin(e)),s.copyPaste(n,e,t,i,(l,o,a)=>{if(a&&a.merge){const[f,u]=a.merge;if(f<=0&&u<=0)return;r.add(new j(l,o,l+f,o+u))}})}function bn(n,e){const{clipboard:t,rows:i,merges:s}=this;i.cutPaste(n,e),s.move(n,e.sri-n.sri,e.sci-n.sci),t.clear()}function Ce(n,e,t){const{styles:i,rows:s}=this,r=s.getCellOrNew(n,e);let l={};r.style!==void 0&&(l=ee.cloneDeep(i[r.style])),l=ee.merge(l,{border:t}),r.style=this.addStyle(l)}function yn({mode:n,style:e,color:t}){const{styles:i,selector:s,rows:r}=this,{sri:l,sci:o,eri:a,eci:f}=s.range,u=!this.isSignleSelected();if(!(!u&&(n==="inside"||n==="horizontal"||n==="vertical"))){if(n==="outside"&&!u)Ce.call(this,l,o,{top:[e,t],bottom:[e,t],left:[e,t],right:[e,t]});else if(n==="none")s.range.each((h,p)=>{const y=r.getCell(h,p);if(y&&y.style!==void 0){const x=ee.cloneDeep(i[y.style]);delete x.border,y.style=this.addStyle(x)}});else if(n==="all"||n==="inside"||n==="outside"||n==="horizontal"||n==="vertical"){const h=[];for(let p=l;p<=a;p+=1)for(let y=o;y<=f;y+=1){const x=[];for(let S=0;S<h.length;S+=1){const[B,F,P,U]=h[S];if(p===B+P+1&&x.push(S),B<=p&&p<=B+P&&y===F){y+=U+1;break}}if(x.forEach(S=>h.splice(S,1)),y>f)break;const T=r.getCell(p,y);let[$,R]=[0,0];T&&T.merge&&([$,R]=T.merge,h.push([p,y,$,R]));const O=$>0&&p+$===a,z=R>0&&y+R===f;let N={};n==="all"?N={bottom:[e,t],top:[e,t],left:[e,t],right:[e,t]}:n==="inside"?(!z&&y<f&&(N.right=[e,t]),!O&&p<a&&(N.bottom=[e,t])):n==="horizontal"?!O&&p<a&&(N.bottom=[e,t]):n==="vertical"?!z&&y<f&&(N.right=[e,t]):n==="outside"&&u&&(l===p&&(N.top=[e,t]),(O||a===p)&&(N.bottom=[e,t]),o===y&&(N.left=[e,t]),(z||f===y)&&(N.right=[e,t])),Object.keys(N).length>0&&Ce.call(this,p,y,N),y+=R}}else if(n==="top"||n==="bottom")for(let h=o;h<=f;h+=1)n==="top"&&(Ce.call(this,l,h,{top:[e,t]}),h+=r.getCellMerge(l,h)[1]),n==="bottom"&&(Ce.call(this,a,h,{bottom:[e,t]}),h+=r.getCellMerge(a,h)[1]);else if(n==="left"||n==="right")for(let h=l;h<=a;h+=1)n==="left"&&(Ce.call(this,h,o,{left:[e,t]}),h+=r.getCellMerge(h,o)[0]),n==="right"&&(Ce.call(this,h,f,{right:[e,t]}),h+=r.getCellMerge(h,f)[0])}}function xn(n,e){const{rows:t}=this,i=this.freezeTotalHeight();let s=t.height;i+t.height<n&&(s-=e);const r=this.exceptRowSet;let l=0,o=s,{height:a}=t;for(;l<t.len&&!(o>n);l+=1)r.has(l)||(a=t.getHeight(l),o+=a);return o-=a,o<=0?{ri:-1,top:0,height:a}:{ri:l-1,top:o,height:a}}function En(n,e){const{cols:t}=this,i=this.freezeTotalWidth();let s=t.indexWidth;i+t.indexWidth<n&&(s-=e);const[r,l,o]=ee.rangeReduceIf(0,t.len,s,t.indexWidth,n,a=>t.getWidth(a));return l<=0?{ci:-1,left:0,width:t.indexWidth}:{ci:r-1,left:l,width:o}}class Sn{constructor(e,t){this.settings=ee.merge(mn,t||{}),this.name=e||"sheet",this.freeze=[0,0],this.styles=[],this.merges=new It,this.rows=new dn(this.settings.row),this.cols=new un(this.settings.col),this.validations=new pn,this.hyperlinks={},this.comments={},this.selector=new Qs,this.scroll=new en,this.history=new tn,this.clipboard=new sn,this.autoFilter=new nn,this.change=()=>{},this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map}addValidation(e,t,i){this.changeData(()=>{this.validations.add(e,t,i)})}removeValidation(){const{range:e}=this.selector;this.changeData(()=>{this.validations.remove(e)})}getSelectedValidator(){const{ri:e,ci:t}=this.selector,i=this.validations.get(e,t);return i?i.validator:null}getSelectedValidation(){const{ri:e,ci:t,range:i}=this.selector,s=this.validations.get(e,t),r={ref:i.toString()};return s!==null&&(r.mode=s.mode,r.validator=s.validator),r}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}undo(){this.history.undo(this.getData(),e=>{this.setData(e)})}redo(){this.history.redo(this.getData(),e=>{this.setData(e)})}copy(){this.clipboard.copy(this.selector.range)}copyToSystemClipboard(){if(navigator.clipboard===void 0)return;let e="";const t=this.rows.getData();for(let i=this.selector.range.sri;i<=this.selector.range.eri;i+=1){if(ai(t,i)){for(let s=this.selector.range.sci;s<=this.selector.range.eci;s+=1)if(s>this.selector.range.sci&&(e+="	"),ai(t[i].cells,s)){const r=String(t[i].cells[s].text);r.indexOf(`
`)===-1&&r.indexOf("	")===-1&&r.indexOf('"')===-1?e+=r:e+=`"${r}"`}}else for(let s=this.selector.range.sci;s<=this.selector.range.eci;s+=1)e+="	";e+=`
`}navigator.clipboard.writeText(e).then(()=>{},i=>{console.log("text copy to the system clipboard error  ",e,i)})}cut(){this.clipboard.cut(this.selector.range)}paste(e="all",t=()=>{}){const{clipboard:i,selector:s}=this;return i.isClear()||!ci.call(this,i.range,s.range,t)?!1:(this.changeData(()=>{i.isCopy()?hi.call(this,i.range,s.range,e):i.isCut()&&bn.call(this,i.range,s.range)}),!0)}pasteFromText(e){const t=e.split(`\r
`).map(r=>r.replace(/"/g,"").split("	"));t.length>0&&(t.length-=1);const{rows:i,selector:s}=this;this.changeData(()=>{i.paste(t,s.range)})}autofill(e,t,i=()=>{}){const s=this.selector.range;return ci.call(this,s,e,i)?(this.changeData(()=>{hi.call(this,s,e,t,!0)}),!0):!1}clearClipboard(){this.clipboard.clear()}calSelectedRangeByEnd(e,t){const{selector:i,rows:s,cols:r,merges:l}=this;let{sri:o,sci:a,eri:f,eci:u}=i.range;const h=i.ri,p=i.ci;let[y,x]=[e,t];return e<0&&(y=s.len-1),t<0&&(x=r.len-1),y>h?[o,f]=[h,y]:[o,f]=[y,h],x>p?[a,u]=[p,x]:[a,u]=[x,p],i.range=l.union(new j(o,a,f,u)),i.range=l.union(i.range),i.range}calSelectedRangeByStart(e,t){const{selector:i,rows:s,cols:r,merges:l}=this;let o=l.getFirstIncludes(e,t);return o===null&&(o=new j(e,t,e,t),e===-1&&(o.sri=0,o.eri=s.len-1),t===-1&&(o.sci=0,o.eci=r.len-1)),i.range=o,o}setSelectedCellAttr(e,t){this.changeData(()=>{const{selector:i,styles:s,rows:r}=this;if(e==="merge")t?this.merge():this.unmerge();else if(e==="border")yn.call(this,t);else if(e==="formula"){const{ri:l,ci:o,range:a}=i;if(i.multiple()){const[f,u]=i.size(),{sri:h,sci:p,eri:y,eci:x}=a;if(f>1)for(let T=p;T<=x;T+=1){const $=r.getCellOrNew(y+1,T);$.text=`=${t}(${he(T,h)}:${he(T,y)})`}else if(u>1){const T=r.getCellOrNew(l,x+1);T.text=`=${t}(${he(p,l)}:${he(x,l)})`}}else{const f=r.getCellOrNew(l,o);f.text=`=${t}()`}}else i.range.each((l,o)=>{const a=r.getCellOrNew(l,o);let f={};if(a.style!==void 0&&(f=ee.cloneDeep(s[a.style])),e==="format")f.format=t,a.style=this.addStyle(f);else if(e==="font-bold"||e==="font-italic"||e==="font-name"||e==="font-size"){const u={};u[e.split("-")[1]]=t,f.font=Object.assign(f.font||{},u),a.style=this.addStyle(f)}else e==="strike"||e==="textwrap"||e==="underline"||e==="align"||e==="valign"||e==="color"||e==="bgcolor"?(f[e]=t,a.style=this.addStyle(f)):a[e]=t})})}setSelectedCellText(e,t="input"){const{autoFilter:i,selector:s,rows:r}=this,{ri:l,ci:o}=s;let a=l;this.unsortedRowMap.has(l)&&(a=this.unsortedRowMap.get(l));const f=r.getCell(a,o),u=f?f.text:"";if(this.setCellText(a,o,e,t),i.active()){const h=i.getFilter(o);if(h){const p=h.value.findIndex(y=>y===u);p>=0&&h.value.splice(p,1,e)}}}getSelectedCell(){const{ri:e,ci:t}=this.selector;let i=e;return this.unsortedRowMap.has(e)&&(i=this.unsortedRowMap.get(e)),this.rows.getCell(i,t)}xyInSelectedRect(e,t){const{left:i,top:s,width:r,height:l}=this.getSelectedRect(),o=e-this.cols.indexWidth,a=t-this.rows.height;return o>i&&o<i+r&&a>s&&a<s+l}getSelectedRect(){return this.getRect(this.selector.range)}getClipboardRect(){const{clipboard:e}=this;return e.isClear()?{left:-100,top:-100}:this.getRect(e.range)}getRect(e){const{scroll:t,rows:i,cols:s,exceptRowSet:r}=this,{sri:l,sci:o,eri:a,eci:f}=e;if(l<0&&o<0)return{left:0,l:0,top:0,t:0,scroll:t};const u=s.sumWidth(0,o),h=i.sumHeight(0,l,r),p=i.sumHeight(l,a+1,r),y=s.sumWidth(o,f+1);let x=u-t.x,T=h-t.y;const $=this.freezeTotalHeight(),R=this.freezeTotalWidth();return R>0&&R>u&&(x=u),$>0&&$>h&&(T=h),{l:u,t:h,left:x,top:T,height:p,width:y,scroll:t}}getCellRectByXY(e,t){const{scroll:i,merges:s,rows:r,cols:l}=this;let{ri:o,top:a,height:f}=xn.call(this,t,i.y),{ci:u,left:h,width:p}=En.call(this,e,i.x);if(u===-1&&(p=l.totalWidth()),o===-1&&(f=r.totalHeight()),o>=0||u>=0){const y=s.getFirstIncludes(o,u);y&&(o=y.sri,u=y.sci,{left:h,top:a,width:p,height:f}=this.cellRect(o,u))}return{ri:o,ci:u,left:h,top:a,width:p,height:f}}isSignleSelected(){const{sri:e,sci:t,eri:i,eci:s}=this.selector.range,r=this.getCell(e,t);if(r&&r.merge){const[l,o]=r.merge;if(e+l===i&&t+o===s)return!0}return!this.selector.multiple()}canUnmerge(){const{sri:e,sci:t,eri:i,eci:s}=this.selector.range,r=this.getCell(e,t);if(r&&r.merge){const[l,o]=r.merge;if(e+l===i&&t+o===s)return!0}return!1}merge(){const{selector:e,rows:t}=this;if(this.isSignleSelected())return;const[i,s]=e.size();if(i>1||s>1){const{sri:r,sci:l}=e.range;this.changeData(()=>{const o=t.getCellOrNew(r,l);o.merge=[i-1,s-1],this.merges.add(e.range),this.rows.deleteCells(e.range),this.rows.setCell(r,l,o)})}}unmerge(){const{selector:e}=this;if(!this.isSignleSelected())return;const{sri:t,sci:i}=e.range;this.changeData(()=>{this.rows.deleteCell(t,i,"merge"),this.merges.deleteWithin(e.range)})}canAutofilter(){return!this.autoFilter.active()}autofilter(){const{autoFilter:e,selector:t}=this;this.changeData(()=>{e.active()?(e.clear(),this.exceptRowSet=new Set,this.sortedRowMap=new Map,this.unsortedRowMap=new Map):e.ref=t.range.toString()})}setAutoFilter(e,t,i,s){const{autoFilter:r}=this;r.addFilter(e,i,s),r.setSort(e,t),this.resetAutoFilter()}resetAutoFilter(){const{autoFilter:e,rows:t}=this;if(!e.active())return;const{sort:i}=e,{rset:s,fset:r}=e.filteredRows((a,f)=>t.getCell(a,f)),l=Array.from(r),o=Array.from(r);i&&l.sort((a,f)=>i.order==="asc"?a-f:i.order==="desc"?f-a:0),this.exceptRowSet=s,this.sortedRowMap=new Map,this.unsortedRowMap=new Map,l.forEach((a,f)=>{this.sortedRowMap.set(o[f],a),this.unsortedRowMap.set(a,o[f])})}deleteCell(e="all"){const{selector:t}=this;this.changeData(()=>{this.rows.deleteCells(t.range,e),(e==="all"||e==="format")&&this.merges.deleteWithin(t.range)})}insert(e,t=1){this.changeData(()=>{const{sri:i,sci:s}=this.selector.range,{rows:r,merges:l,cols:o}=this;let a=i;e==="row"?r.insert(i,t):e==="column"&&(r.insertColumn(s,t),a=s,o.len+=1),l.shift(e,a,t,(f,u,h,p)=>{const y=r.getCell(f,u);y.merge[0]+=h,y.merge[1]+=p})})}delete(e){this.changeData(()=>{const{rows:t,merges:i,selector:s,cols:r}=this,{range:l}=s,{sri:o,sci:a,eri:f,eci:u}=s.range,[h,p]=s.range.size();let y=o,x=h;e==="row"?t.delete(o,f):e==="column"&&(t.deleteColumn(a,u),y=l.sci,x=p,r.len-=1),i.shift(e,y,-x,(T,$,R,O)=>{const z=t.getCell(T,$);z.merge[0]+=R,z.merge[1]+=O,z.merge[0]===0&&z.merge[1]===0&&delete z.merge})})}scrollx(e,t){const{scroll:i,freeze:s,cols:r}=this,[,l]=s,[o,a,f]=ee.rangeReduceIf(l,r.len,0,0,e,h=>r.getWidth(h));let u=a;e>0&&(u+=f),i.x!==u&&(i.ci=e>0?o:0,i.x=u,t())}scrolly(e,t){const{scroll:i,freeze:s,rows:r}=this,[l]=s,[o,a,f]=ee.rangeReduceIf(l,r.len,0,0,e,h=>r.getHeight(h));let u=a;e>0&&(u+=f),i.y!==u&&(i.ri=e>0?o:0,i.y=u,t())}cellRect(e,t){const{rows:i,cols:s}=this,r=s.sumWidth(0,t),l=i.sumHeight(0,e),o=i.getCell(e,t);let a=s.getWidth(t),f=i.getHeight(e);if(o!==null&&o.merge){const[u,h]=o.merge;if(u>0)for(let p=1;p<=u;p+=1)f+=i.getHeight(e+p);if(h>0)for(let p=1;p<=h;p+=1)a+=s.getWidth(t+p)}return{left:r,top:l,width:a,height:f,cell:o}}getCell(e,t){return this.rows.getCell(e,t)}getCellTextOrDefault(e,t){const i=this.getCell(e,t);return i&&i.text?i.text:""}getCellStyle(e,t){const i=this.getCell(e,t);return i&&i.style!==void 0?this.styles[i.style]:null}getCellStyleOrDefault(e,t){const{styles:i,rows:s}=this,r=s.getCell(e,t),l=r&&r.style!==void 0?i[r.style]:{};return ee.merge(this.defaultStyle(),l)}getSelectedCellStyle(){const{ri:e,ci:t}=this.selector;return this.getCellStyleOrDefault(e,t)}setCellText(e,t,i,s){const{rows:r,history:l,validations:o}=this;s==="finished"?(r.setCellText(e,t,""),l.add(this.getData()),r.setCellText(e,t,i)):(r.setCellText(e,t,i),this.change(this.getData())),o.validate(e,t,i)}freezeIsActive(){const[e,t]=this.freeze;return e>0||t>0}setFreeze(e,t){this.changeData(()=>{this.freeze=[e,t]})}freezeTotalWidth(){return this.cols.sumWidth(0,this.freeze[1])}freezeTotalHeight(){return this.rows.sumHeight(0,this.freeze[0])}setRowHeight(e,t){this.changeData(()=>{this.rows.setHeight(e,t)})}setColWidth(e,t){this.changeData(()=>{this.cols.setWidth(e,t)})}viewHeight(){const{view:e,showToolbar:t,showBottomBar:i}=this.settings;let s=e.height();return i&&(s-=wn),t&&(s-=vn),s}viewWidth(){return this.settings.view.width()}freezeViewRange(){const[e,t]=this.freeze;return new j(0,0,e-1,t-1,this.freezeTotalWidth(),this.freezeTotalHeight())}contentRange(){const{rows:e,cols:t}=this,[i,s]=e.maxCell(),r=e.sumHeight(0,i+1),l=t.sumWidth(0,s+1);return new j(0,0,i,s,l,r)}exceptRowTotalHeight(e,t){const{exceptRowSet:i,rows:s}=this,r=Array.from(i);let l=0;return r.forEach(o=>{if(o<e||o>t){const a=s.getHeight(o);l+=a}}),l}viewRange(){const{scroll:e,rows:t,cols:i,freeze:s,exceptRowSet:r}=this;let{ri:l,ci:o}=e;l<=0&&([l]=s),o<=0&&([,o]=s);let[a,f]=[0,0],[u,h]=[t.len,i.len];for(let p=l;p<t.len&&(r.has(p)||(f+=t.getHeight(p),u=p),!(f>this.viewHeight()));p+=1);for(let p=o;p<i.len&&(a+=i.getWidth(p),h=p,!(a>this.viewWidth()));p+=1);return new j(l,o,u,h,a,f)}eachMergesInView(e,t){this.merges.filterIntersects(e).forEach(i=>t(i))}hideRowsOrCols(){const{rows:e,cols:t,selector:i}=this,[s,r]=i.size(),{sri:l,sci:o,eri:a,eci:f}=i.range;if(s===e.len)for(let u=o;u<=f;u+=1)t.setHide(u,!0);else if(r===t.len)for(let u=l;u<=a;u+=1)e.setHide(u,!0)}unhideRowsOrCols(e,t){this[`${e}s`].unhide(t)}rowEach(e,t,i){let s=0;const{rows:r}=this,l=this.exceptRowSet,o=[...l];let a=0;for(let f=0;f<o.length;f+=1)o[f]<e&&(a+=1);for(let f=e+a;f<=t+a;f+=1)if(l.has(f))a+=1;else{const u=r.getHeight(f);if(u>0&&(i(f,s,u),s+=u,s>this.viewHeight()))break}}colEach(e,t,i){let s=0;const{cols:r}=this;for(let l=e;l<=t;l+=1){const o=r.getWidth(l);if(o>0&&(i(l,s,o),s+=o,s>this.viewWidth()))break}}defaultStyle(){return this.settings.style}addStyle(e){const{styles:t}=this;for(let i=0;i<t.length;i+=1){const s=t[i];if(ee.equals(s,e))return i}return t.push(e),t.length-1}changeData(e){this.history.add(this.getData()),e(),this.change(this.getData())}setData(e){return Object.keys(e).forEach(t=>{if(t==="merges"||t==="rows"||t==="cols"||t==="validations")this[t].setData(e[t]);else if(t==="freeze"){const[i,s]=me(e[t]);this.freeze=[s,i]}else t==="autofilter"?this.autoFilter.setData(e[t]):e[t]!==void 0&&(this[t]=e[t])}),this}getData(){const{name:e,freeze:t,styles:i,merges:s,rows:r,cols:l,validations:o,autoFilter:a}=this;return{name:e,freeze:he(t[1],t[0]),styles:i,merges:s.getData(),rows:r.getData(),cols:l.getData(),validations:o.getData(),autofilter:a.getData()}}}function ie(n,e,t){n.addEventListener(e,t)}function Je(n,e,t){n.removeEventListener(e,t)}function De(n){n.xclickoutside&&(Je(window.document.body,"click",n.xclickoutside),delete n.xclickoutside)}function Fe(n,e){n.xclickoutside=t=>{t.detail===2||n.contains(t.target)||(e?e(n):(n.hide(),De(n)))},ie(window.document.body,"click",n.xclickoutside)}function Fi(n,e,t){ie(n,"mousemove",e);const i=n;i.xEvtUp=s=>{Je(n,"mousemove",e),Je(n,"mouseup",n.xEvtUp),t(s)},ie(n,"mouseup",n.xEvtUp)}function fi(n,e,t,i){let s="";Math.abs(n)>Math.abs(e)?(s=n>0?"right":"left",i(s,n,t)):(s=e>0?"down":"up",i(s,e,t))}function Cn(n,{move:e,end:t}){let i=0,s=0;ie(n,"touchstart",r=>{const{pageX:l,pageY:o}=r.touches[0];i=l,s=o}),ie(n,"touchmove",r=>{if(!e)return;const{pageX:l,pageY:o}=r.changedTouches[0],a=l-i,f=o-s;(Math.abs(a)>10||Math.abs(f)>10)&&(fi(a,f,r,e),i=l,s=o),r.preventDefault()}),ie(n,"touchend",r=>{if(!t)return;const{pageX:l,pageY:o}=r.changedTouches[0],a=l-i,f=o-s;fi(a,f,r,t)})}function kn(){const n=new Map;function e(l,o){const a=()=>{const u=n.get(l);return Array.isArray(u)&&u.push(o)||!1},f=()=>n.set(l,[].concat(o));return n.has(l)&&a()||f()}function t(l,o){const a=()=>{const f=n.get(l);for(const u of f)u.call(null,...o)};return n.has(l)&&a()}function i(l,o){const a=()=>{const f=n.get(l),u=f.indexOf(o);return u>=0&&f.splice(u,1)&&n.get(l).length===0&&n.delete(l)};return n.has(l)&&a()}function s(l,o){const a=(...f)=>{o.call(null,...f),i(l,a)};return e(l,a)}function r(){n.clear()}return{get current(){return n},on:e,once:s,fire:t,removeListener:i,removeAllListeners:r}}const k="x-spreadsheet";class di{constructor(e=!1,t){this.moving=!1,this.vertical=e,this.el=b("div",`${k}-resizer ${e?"vertical":"horizontal"}`).children(this.unhideHoverEl=b("div",`${k}-resizer-hover`).on("dblclick.stop",i=>this.mousedblclickHandler(i)).css("position","absolute").hide(),this.hoverEl=b("div",`${k}-resizer-hover`).on("mousedown.stop",i=>this.mousedownHandler(i)),this.lineEl=b("div",`${k}-resizer-line`).hide()).hide(),this.cRect=null,this.finishedFn=null,this.minDistance=t,this.unhideFn=()=>{}}showUnhide(e){this.unhideIndex=e,this.unhideHoverEl.show()}hideUnhide(){this.unhideHoverEl.hide()}show(e,t){const{moving:i,vertical:s,hoverEl:r,lineEl:l,el:o,unhideHoverEl:a}=this;if(i)return;this.cRect=e;const{left:f,top:u,width:h,height:p}=e;o.offset({left:s?f+h-5:f,top:s?u:u+p-5}).show(),r.offset({width:s?5:h,height:s?p:5}),l.offset({width:s?0:t.width,height:s?t.height:0}),a.offset({left:s?5-h:f,top:s?u:5-p,width:s?5:h,height:s?p:5})}hide(){this.el.offset({left:0,top:0}).hide(),this.hideUnhide()}mousedblclickHandler(){this.unhideIndex&&this.unhideFn(this.unhideIndex)}mousedownHandler(e){let t=e;const{el:i,lineEl:s,cRect:r,vertical:l,minDistance:o}=this;let a=l?r.width:r.height;s.show(),Fi(window,f=>{this.moving=!0,t!==null&&f.buttons===1&&(l?(a+=f.movementX,a>o&&i.css("left",`${r.left+a}px`)):(a+=f.movementY,a>o&&i.css("top",`${r.top+a}px`)),t=f)},()=>{t=null,s.hide(),this.moving=!1,this.hide(),this.finishedFn&&(a<o&&(a=o),this.finishedFn(r,a))})}}class ui{constructor(e){this.vertical=e,this.moveFn=null,this.el=b("div",`${k}-scrollbar ${e?"vertical":"horizontal"}`).child(this.contentEl=b("div","")).on("mousemove.stop",()=>{}).on("scroll.stop",t=>{const{scrollTop:i,scrollLeft:s}=t.target;this.moveFn&&this.moveFn(this.vertical?i:s,t)})}move(e){return this.el.scroll(e),this}scroll(){return this.el.scroll()}set(e,t){const i=e-1;if(t>i){const s=this.vertical?"height":"width";this.el.css(s,`${i-15}px`).show(),this.contentEl.css(this.vertical?"width":"height","1px").css(s,`${t}px`)}else this.el.hide();return this}}const We=2*2-1;let xt=10;class Ve{constructor(e=!1){this.useHideInput=e,this.inputChange=()=>{},this.cornerEl=b("div",`${k}-selector-corner`),this.areaEl=b("div",`${k}-selector-area`).child(this.cornerEl).hide(),this.clipboardEl=b("div",`${k}-selector-clipboard`).hide(),this.autofillEl=b("div",`${k}-selector-autofill`).hide(),this.el=b("div",`${k}-selector`).css("z-index",`${xt}`).children(this.areaEl,this.clipboardEl,this.autofillEl).hide(),e&&(this.hideInput=b("input","").on("compositionend",t=>{this.inputChange(t.target.value)}),this.el.child(this.hideInputDiv=b("div","hide-input").child(this.hideInput)),this.el.child(this.hideInputDiv=b("div","hide-input").child(this.hideInput))),xt+=1}setOffset(e){return this.el.offset(e).show(),this}hide(){return this.el.hide(),this}setAreaOffset(e){const{left:t,top:i,width:s,height:r}=e,l={width:s-We+.8,height:r-We+.8,left:t-.8,top:i-.8};this.areaEl.offset(l).show(),this.useHideInput&&(this.hideInputDiv.offset(l),this.hideInput.val("").focus())}setClipboardOffset(e){const{left:t,top:i,width:s,height:r}=e;this.clipboardEl.offset({left:t,top:i,width:s-5,height:r-5})}showAutofill(e){const{left:t,top:i,width:s,height:r}=e;this.autofillEl.offset({width:s-We,height:r-We,left:t,top:i}).show()}hideAutofill(){this.autofillEl.hide()}showClipboard(){this.clipboardEl.show()}hideClipboard(){this.clipboardEl.hide()}}function _t(n){const{data:e}=this,{left:t,top:i,width:s,height:r,scroll:l,l:o,t:a}=n,f=e.freezeTotalWidth(),u=e.freezeTotalHeight();let h=t-f;f>o&&(h-=l.x);let p=i-u;return u>a&&(p-=l.y),{left:h,top:p,width:s,height:r}}function Dt(n){const{data:e}=this,{left:t,width:i,height:s,l:r,t:l,scroll:o}=n,a=e.freezeTotalWidth();let f=t-a;return a>r&&(f-=o.x),{left:f,top:l,width:i,height:s}}function $t(n){const{data:e}=this,{top:t,width:i,height:s,l:r,t:l,scroll:o}=n,a=e.freezeTotalHeight();let f=t-a;return a>l&&(f-=o.y),{left:r,top:f,width:i,height:s}}function Et(n){const{br:e}=this;e.setAreaOffset(_t.call(this,n))}function Tn(n){const{tl:e}=this;e.setAreaOffset(n)}function Mi(n){const{t:e}=this;e.setAreaOffset(Dt.call(this,n))}function Bi(n){const{l:e}=this;e.setAreaOffset($t.call(this,n))}function Pi(n){const{l:e}=this;e.setClipboardOffset($t.call(this,n))}function St(n){const{br:e}=this;e.setClipboardOffset(_t.call(this,n))}function In(n){const{tl:e}=this;e.setClipboardOffset(n)}function Hi(n){const{t:e}=this;e.setClipboardOffset(Dt.call(this,n))}function gi(n){Et.call(this,n),Tn.call(this,n),Mi.call(this,n),Bi.call(this,n)}function pi(n){St.call(this,n),In.call(this,n),Hi.call(this,n),Pi.call(this,n)}class _n{constructor(e){this.inputChange=()=>{},this.data=e,this.br=new Ve(!0),this.t=new Ve,this.l=new Ve,this.tl=new Ve,this.br.inputChange=t=>{this.inputChange(t)},this.br.el.show(),this.offset=null,this.areaOffset=null,this.indexes=null,this.range=null,this.arange=null,this.el=b("div",`${k}-selectors`).children(this.tl.el,this.t.el,this.l.el,this.br.el).hide(),this.lastri=-1,this.lastci=-1,xt+=1}resetData(e){this.data=e,this.range=e.selector.range,this.resetAreaOffset()}hide(){this.el.hide()}resetOffset(){const{data:e,tl:t,t:i,l:s,br:r}=this,l=e.freezeTotalHeight(),o=e.freezeTotalWidth();l>0||o>0?(t.setOffset({width:o,height:l}),i.setOffset({left:o,height:l}),s.setOffset({top:l,width:o}),r.setOffset({left:o,top:l})):(t.hide(),i.hide(),s.hide(),r.setOffset({left:0,top:0}))}resetAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();gi.call(this,e),pi.call(this,t),this.resetOffset()}resetBRTAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();Et.call(this,e),Mi.call(this,e),St.call(this,t),Hi.call(this,t),this.resetOffset()}resetBRLAreaOffset(){const e=this.data.getSelectedRect(),t=this.data.getClipboardRect();Et.call(this,e),Bi.call(this,e),St.call(this,t),Pi.call(this,t),this.resetOffset()}set(e,t,i=!0){const{data:s}=this,r=s.calSelectedRangeByStart(e,t),{sri:l,sci:o}=r;if(i){let[a,f]=[e,t];e<0&&(a=0),t<0&&(f=0),s.selector.setIndexes(a,f),this.indexes=[a,f]}this.moveIndexes=[l,o],this.range=r,this.resetAreaOffset(),this.el.show()}setEnd(e,t,i=!0){const{data:s,lastri:r,lastci:l}=this;if(i){if(e===r&&t===l)return;this.lastri=e,this.lastci=t}this.range=s.calSelectedRangeByEnd(e,t),gi.call(this,this.data.getSelectedRect())}reset(){const{eri:e,eci:t}=this.data.selector.range;this.setEnd(e,t)}showAutofill(e,t){if(e===-1&&t===-1)return;const{sri:i,sci:s,eri:r,eci:l}=this.range,[o,a]=[e,t],f=i-e,u=s-t,h=r-e,p=l-t;if(u>0)this.arange=new j(i,a,r,s-1);else if(f>0)this.arange=new j(o,s,i-1,l);else if(p<0)this.arange=new j(i,l+1,r,a);else if(h<0)this.arange=new j(r+1,s,o,l);else{this.arange=null;return}if(this.arange!==null){const y=this.data.getRect(this.arange);y.width+=2,y.height+=2;const{br:x,l:T,t:$,tl:R}=this;x.showAutofill(_t.call(this,y)),T.showAutofill($t.call(this,y)),$.showAutofill(Dt.call(this,y)),R.showAutofill(y)}}hideAutofill(){["br","l","t","tl"].forEach(e=>{this[e].hideAutofill()})}showClipboard(){const e=this.data.getClipboardRect();pi.call(this,e),["br","l","t","tl"].forEach(t=>{this[t].showClipboard()})}hideClipboard(){["br","l","t","tl"].forEach(e=>{this[e].hideClipboard()})}}function Dn(n){n.preventDefault(),n.stopPropagation();const{filterItems:e}=this;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex-=1,this.itemIndex<0&&(this.itemIndex=e.length-1),e[this.itemIndex].toggle())}function $n(n){n.stopPropagation();const{filterItems:e}=this;e.length<=0||(this.itemIndex>=0&&e[this.itemIndex].toggle(),this.itemIndex+=1,this.itemIndex>e.length-1&&(this.itemIndex=0),e[this.itemIndex].toggle())}function mi(n){n.preventDefault();const{filterItems:e}=this;e.length<=0||(n.stopPropagation(),this.itemIndex<0&&(this.itemIndex=0),e[this.itemIndex].el.click(),this.hide())}function Rn(n){const{keyCode:e}=n;switch(n.ctrlKey&&n.stopPropagation(),e){case 37:n.stopPropagation();break;case 38:Dn.call(this,n);break;case 39:n.stopPropagation();break;case 40:$n.call(this,n);break;case 13:mi.call(this,n);break;case 9:mi.call(this,n);break;default:n.stopPropagation();break}}class Li{constructor(e,t,i="200px"){this.filterItems=[],this.items=e,this.el=b("div",`${k}-suggest`).css("width",i).hide(),this.itemClick=t,this.itemIndex=-1}setOffset(e){this.el.cssRemoveKeys("top","bottom").offset(e)}hide(){const{el:e}=this;this.filterItems=[],this.itemIndex=-1,e.hide(),De(this.el.parent())}setItems(e){this.items=e}search(e){let{items:t}=this;if(/^\s*$/.test(e)||(t=t.filter(s=>(s.key||s).startsWith(e.toUpperCase()))),t=t.map(s=>{let{title:r}=s;r?typeof r=="function"&&(r=r()):r=s;const l=b("div",`${k}-item`).child(r).on("click.stop",()=>{this.itemClick(s),this.hide()});return s.label&&l.child(b("div","label").html(s.label)),l}),this.filterItems=t,t.length<=0)return;const{el:i}=this;i.html("").children(...t).show(),Fe(i.parent(),()=>{this.hide()})}bindInputEvents(e){e.on("keydown",t=>Rn.call(this,t))}}class Q extends xe{constructor(e){super("div",`${k}-icon`),this.iconNameEl=b("div",`${k}-icon-img ${e}`),this.child(this.iconNameEl)}setName(e){this.iconNameEl.className(`${k}-icon-img ${e}`)}}function vi(n,e){n.setMonth(n.getMonth()+e)}function An(n,e){const t=new Date(n);return t.setDate(e-n.getDay()+1),t}function On(n,e,t){const i=new Date(n,e,1,23,59,59),s=[[],[],[],[],[],[]];for(let r=0;r<6;r+=1)for(let l=0;l<7;l+=1){const o=r*7+l,a=An(i,o),f=a.getMonth()!==e,u=a.getMonth()===t.getMonth()&&a.getDate()===t.getDate();s[r][l]={d:a,disabled:f,active:u}}return s}class zn{constructor(e){this.value=e,this.cvalue=new Date(e),this.headerLeftEl=b("div","calendar-header-left"),this.bodyEl=b("tbody",""),this.buildAll(),this.el=b("div","x-spreadsheet-calendar").children(b("div","calendar-header").children(this.headerLeftEl,b("div","calendar-header-right").children(b("a","calendar-prev").on("click.stop",()=>this.prev()).child(new Q("chevron-left")),b("a","calendar-next").on("click.stop",()=>this.next()).child(new Q("chevron-right")))),b("table","calendar-body").children(b("thead","").child(b("tr","").children(...K("calendar.weeks").map(t=>b("th","cell").child(t)))),this.bodyEl)),this.selectChange=()=>{}}setValue(e){this.value=e,this.cvalue=new Date(e),this.buildAll()}prev(){const{value:e}=this;vi(e,-1),this.buildAll()}next(){const{value:e}=this;vi(e,1),this.buildAll()}buildAll(){this.buildHeaderLeft(),this.buildBody()}buildHeaderLeft(){const{value:e}=this;this.headerLeftEl.html(`${K("calendar.months")[e.getMonth()]} ${e.getFullYear()}`)}buildBody(){const{value:e,cvalue:t,bodyEl:i}=this,r=On(e.getFullYear(),e.getMonth(),t).map(l=>{const o=l.map(a=>{let f="cell";return a.disabled&&(f+=" disabled"),a.active&&(f+=" active"),b("td","").child(b("div",f).on("click.stop",()=>{this.selectChange(a.d)}).child(a.d.getDate().toString()))});return b("tr","").children(...o)});i.html("").children(...r)}}class Nn{constructor(){this.calendar=new zn(new Date),this.el=b("div",`${k}-datepicker`).child(this.calendar.el).hide()}setValue(e){const{calendar:t}=this;return typeof e=="string"?/^\d{4}-\d{1,2}-\d{1,2}$/.test(e)&&t.setValue(new Date(e.replace(new RegExp("-","g"),"/"))):e instanceof Date&&t.setValue(e),this}change(e){this.calendar.selectChange=t=>{e(t),this.hide()}}show(){this.el.show()}hide(){this.el.hide()}}function Qe(){const{inputText:n}=this;if(!/^\s*$/.test(n)){const{textlineEl:e,textEl:t,areaOffset:i}=this,s=n.split(`
`),r=Math.max(...s.map(h=>h.length)),o=e.offset().width/n.length,a=(r+1)*o+5,f=this.viewFn().width-i.left-o;let u=s.length;if(a>i.width){let h=a;a>f&&(h=f,u+=parseInt(a/f,10),u+=a%f>0?1:0),t.css("width",`${h}px`)}u*=this.rowHeight,u>i.height&&t.css("height",`${u}px`)}}function Fn({target:n},e){const{value:t,selectionEnd:i}=n,s=`${t.slice(0,i)}${e}${t.slice(i)}`;n.value=s,n.setSelectionRange(i+1,i+1),this.inputText=s,this.textlineEl.html(s),Qe.call(this)}function Mn(n){const{keyCode:e,altKey:t}=n;e!==13&&e!==9&&n.stopPropagation(),e===13&&t&&(Fn.call(this,n,`
`),n.stopPropagation()),e===13&&!t&&n.preventDefault()}function Bn(n){const e=n.target.value,{suggest:t,textlineEl:i,validator:s}=this,{cell:r}=this;if(r!==null)if("editable"in r&&r.editable===!0||r.editable===void 0){if(this.inputText=e,s)s.type==="list"?t.search(e):t.hide();else{const l=e.lastIndexOf("=");l!==-1?t.search(e.substring(l+1)):t.hide()}i.html(e),Qe.call(this),this.change("input",e)}else n.target.value=r.text;else{if(this.inputText=e,s)s.type==="list"?t.search(e):t.hide();else{const l=e.lastIndexOf("=");l!==-1?t.search(e.substring(l+1)):t.hide()}i.html(e),Qe.call(this),this.change("input",e)}}function Pn(n){const{el:e}=this.textEl;setTimeout(()=>{e.focus(),e.setSelectionRange(n,n)},0)}function Wi(n,e){const{textEl:t,textlineEl:i}=this;t.el.blur(),t.val(n),i.html(n),Pn.call(this,e)}function Hn(n){const{inputText:e,validator:t}=this;let i=0;if(t&&t.type==="list")this.inputText=n,i=this.inputText.length;else{const s=e.lastIndexOf("="),r=e.substring(0,s+1);let l=e.substring(s+1);l.indexOf(")")!==-1?l=l.substring(l.indexOf(")")):l="",this.inputText=`${r+n.key}(`,i=this.inputText.length,this.inputText+=`)${l}`}Wi.call(this,this.inputText,i)}function Ln(){this.suggest.setItems(this.formulas)}function Wn(n){let e=n.getMonth()+1,t=n.getDate();return e<10&&(e=`0${e}`),t<10&&(t=`0${t}`),`${n.getFullYear()}-${e}-${t}`}class Vn{constructor(e,t,i){this.viewFn=t,this.rowHeight=i,this.formulas=e,this.suggest=new Li(e,s=>{Hn.call(this,s)}),this.datepicker=new Nn,this.datepicker.change(s=>{this.setText(Wn(s)),this.clear()}),this.areaEl=b("div",`${k}-editor-area`).children(this.textEl=b("textarea","").on("input",s=>Bn.call(this,s)).on("paste.stop",()=>{}).on("keydown",s=>Mn.call(this,s)),this.textlineEl=b("div","textline"),this.suggest.el,this.datepicker.el).on("mousemove.stop",()=>{}).on("mousedown.stop",()=>{}),this.el=b("div",`${k}-editor`).child(this.areaEl).hide(),this.suggest.bindInputEvents(this.textEl),this.areaOffset=null,this.freeze={w:0,h:0},this.cell=null,this.inputText="",this.change=()=>{}}setFreezeLengths(e,t){this.freeze.w=e,this.freeze.h=t}clear(){this.inputText!==""&&this.change("finished",this.inputText),this.cell=null,this.areaOffset=null,this.inputText="",this.el.hide(),this.textEl.val(""),this.textlineEl.html(""),Ln.call(this),this.datepicker.hide()}setOffset(e,t="top"){const{textEl:i,areaEl:s,suggest:r,freeze:l,el:o}=this;if(e){this.areaOffset=e;const{left:a,top:f,width:u,height:h,l:p,t:y}=e,x={left:0,top:0};l.w>p&&l.h>y||(l.w<p&&l.h<y?(x.left=l.w,x.top=l.h):l.w>p?x.top=l.h:l.h>y&&(x.left=l.w)),o.offset(x),s.offset({left:a-x.left-.8,top:f-x.top-.8}),i.offset({width:u-9+.8,height:h-3+.8});const T={left:0};T[t]=h,r.setOffset(T),r.hide()}}setCell(e,t){const{el:i,datepicker:s,suggest:r}=this;i.show(),this.cell=e;const l=e&&e.text||"";if(this.setText(l),this.validator=t,t){const{type:o}=t;o==="date"&&(s.show(),/^\s*$/.test(l)||s.setValue(l)),o==="list"&&(r.setItems(t.values()),r.search(""))}}setText(e){this.inputText=e,Wi.call(this,e,e.length),Qe.call(this)}}class be extends xe{constructor(e,t=""){super("div",`${k}-button ${t}`),this.child(K(`button.${e}`))}}function et(){return window.devicePixelRatio||1}function Rt(){return et()-.5}function M(n){return parseInt(n*et(),10)}function ke(n){const e=M(n);return e>0?e-.5:.5}class Un{constructor(e,t,i,s,r=0){this.x=e,this.y=t,this.width=i,this.height=s,this.padding=r,this.bgcolor="#ffffff",this.borderTop=null,this.borderRight=null,this.borderBottom=null,this.borderLeft=null}setBorders({top:e,bottom:t,left:i,right:s}){e&&(this.borderTop=e),s&&(this.borderRight=s),t&&(this.borderBottom=t),i&&(this.borderLeft=i)}innerWidth(){return this.width-this.padding*2-2}innerHeight(){return this.height-this.padding*2-2}textx(e){const{width:t,padding:i}=this;let{x:s}=this;return e==="left"?s+=i:e==="center"?s+=t/2:e==="right"&&(s+=t-i),s}texty(e,t){const{height:i,padding:s}=this;let{y:r}=this;return e==="top"?r+=s:e==="middle"?r+=i/2-t/2:e==="bottom"&&(r+=i-s-t),r}topxys(){const{x:e,y:t,width:i}=this;return[[e,t],[e+i,t]]}rightxys(){const{x:e,y:t,width:i,height:s}=this;return[[e+i,t],[e+i,t+s]]}bottomxys(){const{x:e,y:t,width:i,height:s}=this;return[[e,t+s],[e+i,t+s]]}leftxys(){const{x:e,y:t,height:i}=this;return[[e,t],[e,t+i]]}}function wi(n,e,t,i,s,r,l){const o={x:0,y:0};n==="underline"?s==="bottom"?o.y=0:s==="top"?o.y=-(r+2):o.y=-r/2:n==="strike"&&(s==="bottom"?o.y=r/2:s==="top"&&(o.y=-(r/2+2))),i==="center"?o.x=l/2:i==="right"&&(o.x=l),this.line([e-o.x,t-o.y],[e-o.x+l,t-o.y])}class Vi{constructor(e,t,i){this.el=e,this.ctx=e.getContext("2d"),this.resize(t,i),this.ctx.scale(et(),et())}resize(e,t){this.el.style.width=`${e}px`,this.el.style.height=`${t}px`,this.el.width=M(e),this.el.height=M(t)}clear(){const{width:e,height:t}=this.el;return this.ctx.clearRect(0,0,e,t),this}attr(e){return Object.assign(this.ctx,e),this}save(){return this.ctx.save(),this.ctx.beginPath(),this}restore(){return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}translate(e,t){return this.ctx.translate(M(e),M(t)),this}scale(e,t){return this.ctx.scale(e,t),this}clearRect(e,t,i,s){return this.ctx.clearRect(e,t,i,s),this}fillRect(e,t,i,s){return this.ctx.fillRect(M(e)-.5,M(t)-.5,M(i),M(s)),this}fillText(e,t,i){return this.ctx.fillText(e,M(t),M(i)),this}text(e,t,i={},s=!0){const{ctx:r}=this,{align:l,valign:o,font:a,color:f,strike:u,underline:h}=i,p=t.textx(l);r.save(),r.beginPath(),this.attr({textAlign:l,textBaseline:o,font:`${a.italic?"italic":""} ${a.bold?"bold":""} ${M(a.size)}px ${a.name}`,fillStyle:f,strokeStyle:f});const y=`${e}`.split(`
`),x=t.innerWidth(),T=[];y.forEach(O=>{const z=r.measureText(O).width;if(s&&z>M(x)){let N={w:0,len:0,start:0};for(let S=0;S<O.length;S+=1)N.w>=M(x)&&(T.push(O.substr(N.start,N.len)),N={w:0,len:0,start:S}),N.len+=1,N.w+=r.measureText(O[S]).width+1;N.len>0&&T.push(O.substr(N.start,N.len))}else T.push(O)});const $=(T.length-1)*(a.size+2);let R=t.texty(o,$);return T.forEach(O=>{const z=r.measureText(O).width;this.fillText(O,p,R),u&&wi.call(this,"strike",p,R,l,o,a.size,z),h&&wi.call(this,"underline",p,R,l,o,a.size,z),R+=a.size+2}),r.restore(),this}border(e,t){const{ctx:i}=this;return i.lineWidth=Rt,i.strokeStyle=t,e==="medium"?i.lineWidth=M(2)-.5:e==="thick"?i.lineWidth=M(3):e==="dashed"?i.setLineDash([M(3),M(2)]):e==="dotted"?i.setLineDash([M(1),M(1)]):e==="double"&&i.setLineDash([M(2),0]),this}line(...e){const{ctx:t}=this;if(e.length>1){t.beginPath();const[i,s]=e[0];t.moveTo(ke(i),ke(s));for(let r=1;r<e.length;r+=1){const[l,o]=e[r];t.lineTo(ke(l),ke(o))}t.stroke()}return this}strokeBorders(e){const{ctx:t}=this;t.save();const{borderTop:i,borderRight:s,borderBottom:r,borderLeft:l}=e;i&&(this.border(...i),this.line(...e.topxys())),s&&(this.border(...s),this.line(...e.rightxys())),r&&(this.border(...r),this.line(...e.bottomxys())),l&&(this.border(...l),this.line(...e.leftxys())),t.restore()}dropdown(e){const{ctx:t}=this,{x:i,y:s,width:r,height:l}=e,o=i+r-15,a=s+l-15;t.save(),t.beginPath(),t.moveTo(M(o),M(a)),t.lineTo(M(o+8),M(a)),t.lineTo(M(o+4),M(a+6)),t.closePath(),t.fillStyle="rgba(0, 0, 0, .45)",t.fill(),t.restore()}error(e){const{ctx:t}=this,{x:i,y:s,width:r}=e,l=i+r-1;t.save(),t.beginPath(),t.moveTo(M(l-8),M(s-1)),t.lineTo(M(l),M(s-1)),t.lineTo(M(l),M(s+8)),t.closePath(),t.fillStyle="rgba(255, 0, 0, .65)",t.fill(),t.restore()}frozen(e){const{ctx:t}=this,{x:i,y:s,width:r}=e,l=i+r-1;t.save(),t.beginPath(),t.moveTo(M(l-8),M(s-1)),t.lineTo(M(l),M(s-1)),t.lineTo(M(l),M(s+8)),t.closePath(),t.fillStyle="rgba(0, 255, 0, .85)",t.fill(),t.restore()}rect(e,t){const{ctx:i}=this,{x:s,y:r,width:l,height:o,bgcolor:a}=e;i.save(),i.beginPath(),i.fillStyle=a||"#fff",i.rect(ke(s+1),ke(r+1),M(l-2),M(o-2)),i.clip(),i.fill(),t(),i.restore()}}const bi=[{key:"Arial",title:"Arial"},{key:"Helvetica",title:"Helvetica"},{key:"Source Sans Pro",title:"Source Sans Pro"},{key:"Comic Sans MS",title:"Comic Sans MS"},{key:"Courier New",title:"Courier New"},{key:"Verdana",title:"Verdana"},{key:"Lato",title:"Lato"}],Ct=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},{pt:42,px:56}];function Yn(n){for(let e=0;e<Ct.length;e+=1){const t=Ct[e];if(t.pt===n)return t.px}return n}const qn=n=>{const e=[],t=[];let i=[],s=0,r="",l=1,o="";for(let a=0;a<n.length;a+=1){const f=n.charAt(a);if(f!==" "){if(f>="a"&&f<="z")i.push(f.toUpperCase());else if(f>="0"&&f<="9"||f>="A"&&f<="Z"||f===".")i.push(f);else if(f==='"'){for(a+=1;n.charAt(a)!=='"';)i.push(n.charAt(a)),a+=1;t.push(`"${i.join("")}`),i=[]}else if(f==="-"&&/[+\-*/,(]/.test(o))i.push(f);else{if(f!=="("&&i.length>0&&t.push(i.join("")),f===")"){let u=e.pop();if(s===2)try{const[h,p]=me(t.pop()),[y,x]=me(t.pop());let T=0;for(let $=y;$<=h;$+=1)for(let R=x;R<=p;R+=1)t.push(he($,R)),T+=1;t.push([u,T])}catch{}else if(s===1||s===3)s===3&&t.push(r),t.push([u,l]),l=1;else for(;u!=="("&&(t.push(u),!(e.length<=0));)u=e.pop();s=0}else if(f==="="||f===">"||f==="<"){const u=n.charAt(a+1);r=f,(u==="="||u==="-")&&(r+=u,a+=1),s=3}else if(f===":")s=2;else if(f===",")s===3&&t.push(r),s=1,l+=1;else if(f==="("&&i.length>0)e.push(i.join(""));else{if(e.length>0&&(f==="+"||f==="-")){let u=e[e.length-1];if(u!=="("&&t.push(e.pop()),u==="*"||u==="/")for(;e.length>0&&(u=e[e.length-1],u!=="(");)t.push(e.pop())}else if(e.length>0){const u=e[e.length-1];(u==="*"||u==="/")&&t.push(e.pop())}e.push(f)}i=[]}o=f}}for(i.length>0&&t.push(i.join(""));e.length>0;)t.push(e.pop());return t},jn=(n,e)=>{const[t]=n;let i=n;if(t==='"')return n.substring(1);let s=1;if(t==="-"&&(i=n.substring(1),s=-1),i[0]>="0"&&i[0]<="9")return s*Number(i);const[r,l]=me(i);return s*e(r,l)},Xn=(n,e,t,i)=>{const s=[];for(let r=0;r<n.length;r+=1){const l=n[r],o=l[0];if(l==="+"){const a=s.pop();s.push(we("+",s.pop(),a))}else if(l==="-")if(s.length===1){const a=s.pop();s.push(we("*",a,-1))}else{const a=s.pop();s.push(we("-",s.pop(),a))}else if(l==="*")s.push(we("*",s.pop(),s.pop()));else if(l==="/"){const a=s.pop();s.push(we("/",s.pop(),a))}else if(o==="="||o===">"||o==="<"){let a=s.pop();Number.isNaN(a)||(a=Number(a));let f=s.pop();Number.isNaN(f)||(f=Number(f));let u=!1;o==="="?u=f===a:l===">"?u=f>a:l===">="?u=f>=a:l==="<"?u=f<a:l==="<="&&(u=f<=a),s.push(u)}else if(Array.isArray(l)){const[a,f]=l,u=[];for(let h=0;h<f;h+=1)u.push(s.pop());s.push(e[a].render(u.reverse()))}else{if(i.includes(l))return 0;(o>="a"&&o<="z"||o>="A"&&o<="Z")&&i.push(l),s.push(jn(l,t)),i.pop()}}return s[0]},Ui=(n,e,t,i=[])=>{if(n[0]==="="){const s=qn(n.substring(1));return s.length<=0?n:Xn(s,e,(r,l)=>Ui(t(r,l),e,t,i),i)}return n},Kn={render:Ui},At=[{key:"SUM",title:L("formula.sum"),render:n=>n.reduce((e,t)=>we("+",e,t),0)},{key:"AVERAGE",title:L("formula.average"),render:n=>n.reduce((e,t)=>Number(e)+Number(t),0)/n.length},{key:"MAX",title:L("formula.max"),render:n=>Math.max(...n.map(e=>Number(e)))},{key:"MIN",title:L("formula.min"),render:n=>Math.min(...n.map(e=>Number(e)))},{key:"IF",title:L("formula._if"),render:([n,e,t])=>n?e:t},{key:"AND",title:L("formula.and"),render:n=>n.every(e=>e)},{key:"OR",title:L("formula.or"),render:n=>n.some(e=>e)},{key:"CONCAT",title:L("formula.concat"),render:n=>n.join("")}],Zn=At,Yi={};At.forEach(n=>{Yi[n.key]=n});const Te=n=>n,Ue=n=>{if(/^(-?\d*.?\d*)$/.test(n)){const e=Number(n).toFixed(2).toString(),[t,...i]=e.split("\\.");return[t.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),...i]}return n},Oe=[{key:"normal",title:L("format.normal"),type:"string",render:Te},{key:"text",title:L("format.text"),type:"string",render:Te},{key:"number",title:L("format.number"),type:"number",label:"1,000.12",render:Ue},{key:"percent",title:L("format.percent"),type:"number",label:"10.12%",render:n=>`${n}%`},{key:"rmb",title:L("format.rmb"),type:"number",label:"10.00",render:n=>`${Ue(n)}`},{key:"usd",title:L("format.usd"),type:"number",label:"$10.00",render:n=>`$${Ue(n)}`},{key:"eur",title:L("format.eur"),type:"number",label:"10.00",render:n=>`${Ue(n)}`},{key:"date",title:L("format.date"),type:"date",label:"26/09/2008",render:Te},{key:"time",title:L("format.time"),type:"date",label:"15:59:00",render:Te},{key:"datetime",title:L("format.datetime"),type:"date",label:"26/09/2008 15:59:00",render:Te},{key:"duration",title:L("format.duration"),type:"date",label:"24:01:00",render:Te}],qi={};Oe.forEach(n=>{qi[n.key]=n});const Gn=5,Jn={fillStyle:"#f4f5f8"},Qn={fillStyle:"#fff",lineWidth:Rt,strokeStyle:"#e6e6e6"};function er(){return{textAlign:"center",textBaseline:"middle",font:`500 ${M(12)}px Source Sans Pro`,fillStyle:"#585757",lineWidth:Rt(),strokeStyle:"#e6e6e6"}}function ji(n,e,t,i=0){const{left:s,top:r,width:l,height:o}=n.cellRect(e,t);return new Un(s,r+i,l,o,Gn)}function tt(n,e,t,i,s=0){const{sortedRowMap:r,rows:l,cols:o}=e;if(l.isHide(t)||o.isHide(i))return;let a=t;r.has(t)&&(a=r.get(t));const f=e.getCell(a,i);if(f===null)return;let u=!1;"editable"in f&&f.editable===!1&&(u=!0);const h=e.getCellStyleOrDefault(a,i),p=ji(e,t,i,s);p.bgcolor=h.bgcolor,h.border!==void 0&&(p.setBorders(h.border),n.strokeBorders(p)),n.rect(p,()=>{let y="";e.settings.evalPaused?y=f.text||"":y=Kn.render(f.text||"",Yi,($,R)=>e.getCellTextOrDefault(R,$)),h.format&&(y=qi[h.format].render(y));const x=Object.assign({},h.font);x.size=Yn(x.size),n.text(y,p,{align:h.align,valign:h.valign,font:x,color:h.color,strike:h.strike,underline:h.underline},h.textwrap),e.validations.getError(t,i)&&n.error(p),u&&n.frozen(p)})}function tr(n){const{data:e,draw:t}=this;if(n){const{autoFilter:i}=e;if(!i.active())return;const s=i.hrange();n.intersects(s)&&s.each((r,l)=>{const o=ji(e,r,l);t.dropdown(o)})}}function Ye(n,e,t,i,s){const{draw:r,data:l}=this;r.save(),r.translate(e,t).translate(i,s);const{exceptRowSet:o}=l,a=h=>{const p=o.has(h);if(p){const y=l.rows.getHeight(h);r.translate(0,-y)}return!p},f=l.exceptRowTotalHeight(n.sri,n.eri);r.save(),r.translate(0,-f),n.each((h,p)=>{tt(r,l,h,p)},h=>a(h)),r.restore();const u=new Set;r.save(),r.translate(0,-f),l.eachMergesInView(n,({sri:h,sci:p,eri:y})=>{if(!o.has(h))tt(r,l,h,p);else if(!u.has(h)){u.add(h);const x=l.rows.sumHeight(h,y+1);r.translate(0,-x)}}),r.restore(),tr.call(this,n),r.restore()}function yi(n,e,t,i){const{draw:s}=this;s.save(),s.attr({fillStyle:"rgba(75, 137, 255, 0.08)"}).fillRect(n,e,t,i),s.restore()}function qe(n,e,t,i,s,r){const{draw:l,data:o}=this,a=e.h,f=e.w,u=r+i,h=s+t;l.save(),l.attr(Jn),(n==="all"||n==="left")&&l.fillRect(0,u,t,a),(n==="all"||n==="top")&&l.fillRect(h,0,f,i);const{sri:p,sci:y,eri:x,eci:T}=o.selector.range;l.attr(er()),(n==="all"||n==="left")&&(o.rowEach(e.sri,e.eri,($,R,O)=>{const z=u+R,N=$;l.line([0,z],[t,z]),p<=N&&N<x+1&&yi.call(this,0,z,t,O),l.fillText(N+1,t/2,z+O/2),$>0&&o.rows.isHide($-1)&&(l.save(),l.attr({strokeStyle:"#c6c6c6"}),l.line([5,z+5],[t-5,z+5]),l.restore())}),l.line([0,a+u],[t,a+u]),l.line([t,u],[t,a+u])),(n==="all"||n==="top")&&(o.colEach(e.sci,e.eci,($,R,O)=>{const z=h+R,N=$;l.line([z,0],[z,i]),y<=N&&N<T+1&&yi.call(this,z,0,O,i),l.fillText(Ri(N),z+O/2,i/2),$>0&&o.cols.isHide($-1)&&(l.save(),l.attr({strokeStyle:"#c6c6c6"}),l.line([z+5,5],[z+5,i-5]),l.restore())}),l.line([f+h,0],[f+h,i]),l.line([0,i],[f+h,i])),l.restore()}function ir(n,e){const{draw:t}=this;t.save(),t.attr({fillStyle:"#f4f5f8"}).fillRect(0,0,n,e),t.restore()}function je({sri:n,sci:e,eri:t,eci:i,w:s,h:r},l,o,a,f){const{draw:u,data:h}=this,{settings:p}=h;if(u.save(),u.attr(Qn).translate(l+a,o+f),!p.showGrid){u.restore();return}h.rowEach(n,t,(y,x,T)=>{y!==n&&u.line([0,x],[s,x]),y===t&&u.line([0,x+T],[s,x+T])}),h.colEach(e,i,(y,x,T)=>{y!==e&&u.line([x,0],[x,r]),y===i&&u.line([x+T,0],[x+T,r])}),u.restore()}function sr(n,e,t,i){const{draw:s,data:r}=this,l=r.viewWidth()-n,o=r.viewHeight()-e;s.save().translate(n,e).attr({strokeStyle:"rgba(75, 137, 255, .6)"}),s.line([0,i],[l,i]),s.line([t,0],[t,o]),s.restore()}class nr{constructor(e,t){this.el=e,this.draw=new Vi(e,t.viewWidth(),t.viewHeight()),this.data=t}resetData(e){this.data=e,this.render()}render(){const{data:e}=this,{rows:t,cols:i}=e,s=i.indexWidth,r=t.height;this.draw.resize(e.viewWidth(),e.viewHeight()),this.clear();const l=e.viewRange(),o=e.freezeTotalWidth(),a=e.freezeTotalHeight(),{x:f,y:u}=e.scroll;je.call(this,l,s,r,o,a),Ye.call(this,l,s,r,-f,-u),qe.call(this,"all",l,s,r,o,a),ir.call(this,s,r);const[h,p]=e.freeze;if(h>0||p>0){if(h>0){const x=l.clone();x.sri=0,x.eri=h-1,x.h=a,je.call(this,x,s,r,o,0),Ye.call(this,x,s,r,-f,0),qe.call(this,"top",x,s,r,o,0)}if(p>0){const x=l.clone();x.sci=0,x.eci=p-1,x.w=o,je.call(this,x,s,r,0,a),qe.call(this,"left",x,s,r,0,a),Ye.call(this,x,s,r,0,-u)}const y=e.freezeViewRange();je.call(this,y,s,r,0,0),qe.call(this,"all",y,s,r,0,0),Ye.call(this,y,s,r,0,0),sr.call(this,s,r,o,a)}}clear(){this.draw.clear()}}const Ke=[["A3",11.69,16.54],["A4",8.27,11.69],["A5",5.83,8.27],["B4",9.84,13.9],["B5",6.93,9.84]],kt=["landscape","portrait"];function it(n){return parseInt(96*n,10)}function xi(n){n==="cancel"?this.el.hide():this.toPrint()}function rr(n){const{paper:e}=this,{value:t}=n.target,i=Ke[t];e.w=it(i[1]),e.h=it(i[2]),this.preview()}function lr(n){const{paper:e}=this,{value:t}=n.target,i=kt[t];e.orientation=i,this.preview()}let or=class{constructor(e){this.paper={w:it(Ke[0][1]),h:it(Ke[0][2]),padding:50,orientation:kt[0],get width(){return this.orientation==="landscape"?this.h:this.w},get height(){return this.orientation==="landscape"?this.w:this.h}},this.data=e,this.el=b("div",`${k}-print`).children(b("div",`${k}-print-bar`).children(b("div","-title").child("Print settings"),b("div","-right").children(b("div",`${k}-buttons`).children(new be("cancel").on("click",xi.bind(this,"cancel")),new be("next","primary").on("click",xi.bind(this,"next"))))),b("div",`${k}-print-content`).children(this.contentEl=b("div","-content"),b("div","-sider").child(b("form","").children(b("fieldset","").children(b("label","").child(`${K("print.size")}`),b("select","").children(...Ke.map((t,i)=>b("option","").attr("value",i).child(`${t[0]} ( ${t[1]}''x${t[2]}'' )`))).on("change",rr.bind(this))),b("fieldset","").children(b("label","").child(`${K("print.orientation")}`),b("select","").children(...kt.map((t,i)=>b("option","").attr("value",i).child(`${K("print.orientations")[i]}`))).on("change",lr.bind(this))))))).hide()}resetData(e){this.data=e}preview(){const{data:e,paper:t}=this,{width:i,height:s,padding:r}=t,l=i-r*2,o=s-r*2,a=e.contentRange(),f=parseInt(a.h/o,10)+1,u=l/a.w;let h=r;const p=r;u>1&&(h+=(l-a.w)/2);let y=0,x=0;this.contentEl.html(""),this.canvases=[];const T={sri:0,sci:0,eri:0,eci:0};for(let $=0;$<f;$+=1){let R=0,O=0;const z=b("div",`${k}-canvas-card`),N=b("canvas",`${k}-canvas`);this.canvases.push(N.el);const S=new Vi(N.el,i,s);for(S.save(),S.translate(h,p),u<1&&S.scale(u,u);y<=a.eri;y+=1){const F=e.rows.getHeight(y);if(R+=F,R<o)for(let P=0;P<=a.eci;P+=1)tt(S,e,y,P,x),T.eci=P;else{O=-(R-F);break}}T.eri=y,S.restore(),S.save(),S.translate(h,p),u<1&&S.scale(u,u);const B=x;e.eachMergesInView(T,({sri:F,sci:P})=>{tt(S,e,F,P,B)}),S.restore(),T.sri=T.eri,T.sci=T.eci,x+=O,this.contentEl.child(b("div",`${k}-canvas-card-wraper`).child(z.child(N)))}this.el.show()}toPrint(){this.el.hide();const{paper:e}=this,t=b("iframe","").hide(),{el:i}=t;window.document.body.appendChild(i);const{contentWindow:s}=i,r=s.document,l=document.createElement("style");l.innerHTML=`
      @page { size: ${e.width}px ${e.height}px; };
      canvas {
        page-break-before: auto;        
        page-break-after: always;
        image-rendering: pixelated;
      };
    `,r.head.appendChild(l),this.canvases.forEach(o=>{const a=o.cloneNode(!1);a.getContext("2d").drawImage(o,0,0),r.body.appendChild(a)}),s.print()}};const ar=[{key:"copy",title:L("contextmenu.copy"),label:"Ctrl+C"},{key:"cut",title:L("contextmenu.cut"),label:"Ctrl+X"},{key:"paste",title:L("contextmenu.paste"),label:"Ctrl+V"},{key:"paste-value",title:L("contextmenu.pasteValue"),label:"Ctrl+Shift+V"},{key:"paste-format",title:L("contextmenu.pasteFormat"),label:"Ctrl+Alt+V"},{key:"divider"},{key:"insert-row",title:L("contextmenu.insertRow")},{key:"insert-column",title:L("contextmenu.insertColumn")},{key:"divider"},{key:"delete-row",title:L("contextmenu.deleteRow")},{key:"delete-column",title:L("contextmenu.deleteColumn")},{key:"delete-cell-text",title:L("contextmenu.deleteCellText")},{key:"hide",title:L("contextmenu.hide")},{key:"divider"},{key:"validation",title:L("contextmenu.validation")},{key:"divider"},{key:"cell-printable",title:L("contextmenu.cellprintable")},{key:"cell-non-printable",title:L("contextmenu.cellnonprintable")},{key:"divider"},{key:"cell-editable",title:L("contextmenu.celleditable")},{key:"cell-non-editable",title:L("contextmenu.cellnoneditable")}];function cr(n){return n.key==="divider"?b("div",`${k}-item divider`):b("div",`${k}-item`).on("click",()=>{this.itemClick(n.key),this.hide()}).children(n.title(),b("div","label").child(n.label||""))}function hr(){return ar.map(n=>cr.call(this,n))}let fr=class{constructor(e,t=!1){this.menuItems=hr.call(this),this.el=b("div",`${k}-contextmenu`).children(...this.menuItems).hide(),this.viewFn=e,this.itemClick=()=>{},this.isHide=t,this.setMode("range")}setMode(e){const t=this.menuItems[12];e==="row-col"?t.show():t.hide()}hide(){const{el:e}=this;e.hide(),De(e)}setPosition(e,t){if(this.isHide)return;const{el:i}=this,{width:s}=i.show().offset(),r=this.viewFn(),l=r.height/2;let o=e;r.width-e<=s&&(o-=s),i.css("left",`${o}px`),t>l?i.css("bottom",`${r.height-t}px`).css("max-height",`${t}px`).css("top","auto"):i.css("top",`${t}px`).css("max-height",`${r.height-t}px`).css("bottom","auto"),Fe(i)}};function dr(n,e){if(e.classList.contains("active"))return;const{left:t,top:i,width:s,height:r}=e.getBoundingClientRect(),l=b("div",`${k}-tooltip`).html(n).show();document.body.appendChild(l.el);const o=l.box();l.css("left",`${t+s/2-o.width/2}px`).css("top",`${i+r+2}px`),ie(e,"mouseleave",()=>{document.body.contains(l.el)&&document.body.removeChild(l.el)}),ie(e,"click",()=>{document.body.contains(l.el)&&document.body.removeChild(l.el)})}class Ot{constructor(e,t,i){this.tip=K(`toolbar.${e.replace(/-[a-z]/g,s=>s[1].toUpperCase())}`),t&&(this.tip+=` (${t})`),this.tag=e,this.shortcut=t,this.value=i,this.el=this.element(),this.change=()=>{}}element(){const{tip:e}=this;return b("div",`${k}-toolbar-btn`).on("mouseenter",t=>{dr(e,t.target)}).attr("data-tooltip",e)}setState(){}}class oe extends Ot{dropdown(){}getValue(e){return e}element(){const{tag:e}=this;return this.dd=this.dropdown(),this.dd.change=t=>this.change(e,this.getValue(t)),super.element().child(this.dd)}setState(e){e&&(this.value=e,this.dd.setTitle(e))}}class ae extends xe{constructor(e,t,i,s,...r){super("div",`${k}-dropdown ${s}`),this.title=e,this.change=()=>{},this.headerClick=()=>{},typeof e=="string"?this.title=b("div",`${k}-dropdown-title`).child(e):i&&this.title.addClass("arrow-left"),this.contentEl=b("div",`${k}-dropdown-content`).css("width",t).hide(),this.setContentChildren(...r),this.headerEl=b("div",`${k}-dropdown-header`),this.headerEl.on("click",()=>{this.contentEl.css("display")!=="block"?this.show():this.hide()}).children(this.title,i?b("div",`${k}-icon arrow-right`).child(b("div",`${k}-icon-img arrow-down`)):""),this.children(this.headerEl,this.contentEl)}setContentChildren(...e){this.contentEl.html(""),e.length>0&&this.contentEl.children(...e)}setTitle(e){this.title.html(e),this.hide()}show(){const{contentEl:e}=this;e.show(),this.parent().active(),Fe(this.parent(),()=>{this.hide()})}hide(){this.parent().active(!1),this.contentEl.hide(),De(this.parent())}}function ur(n){return b("div",`${k}-item`).child(new Q(n))}class Xi extends ae{constructor(e,t){const i=new Q(`align-${t}`),s=e.map(r=>ur(`align-${r}`).on("click",()=>{this.setTitle(r),this.change(r)}));super(i,"auto",!0,"bottom-left",...s)}setTitle(e){this.title.setName(`align-${e}`),this.hide()}}class gr extends oe{constructor(e){super("align","",e)}dropdown(){const{value:e}=this;return new Xi(["left","center","right"],e)}}class pr extends oe{constructor(e){super("valign","",e)}dropdown(){const{value:e}=this;return new Xi(["top","middle","bottom"],e)}}class fe extends Ot{element(){const{tag:e}=this;return super.element().child(new Q(e)).on("click",()=>this.click())}click(){this.change(this.tag,this.toggle())}setState(e){this.el.active(e)}toggle(){return this.el.toggle()}active(){return this.el.hasClass("active")}}class mr extends fe{constructor(){super("autofilter")}setState(){}}class vr extends fe{constructor(){super("font-bold","Ctrl+B")}}class wr extends fe{constructor(){super("font-italic","Ctrl+I")}}class br extends fe{constructor(){super("strike","Ctrl+U")}}class yr extends fe{constructor(){super("underline","Ctrl+U")}}const xr=["#ffffff","#000100","#e7e5e6","#445569","#5b9cd6","#ed7d31","#a5a5a5","#ffc001","#4371c6","#71ae47"],Er=[["#f2f2f2","#7f7f7f","#d0cecf","#d5dce4","#deeaf6","#fce5d5","#ededed","#fff2cd","#d9e2f3","#e3efd9"],["#d8d8d8","#595959","#afabac","#adb8ca","#bdd7ee","#f7ccac","#dbdbdb","#ffe59a","#b3c6e7","#c5e0b3"],["#bfbfbf","#3f3f3f","#756f6f","#8596b0","#9cc2e6","#f4b184","#c9c9c9","#fed964","#8eaada","#a7d08c"],["#a5a5a5","#262626","#3a3839","#333f4f","#2e75b5","#c45a10","#7b7b7b","#bf8e01","#2f5596","#538136"],["#7f7f7f","#0c0c0c","#171516","#222a35","#1f4e7a","#843c0a","#525252","#7e6000","#203864","#365624"]],Sr=["#c00000","#fe0000","#fdc101","#ffff01","#93d051","#00b04e","#01b0f1","#0170c1","#012060","#7030a0"];function pt(n){return b("td","").child(b("div",`${k}-color-palette-cell`).on("click.stop",()=>this.change(n)).css("background-color",n))}class Cr{constructor(){this.el=b("div",`${k}-color-palette`),this.change=()=>{};const e=b("table","").children(b("tbody","").children(b("tr",`${k}-theme-color-placeholders`).children(...xr.map(t=>pt.call(this,t))),...Er.map(t=>b("tr",`${k}-theme-colors`).children(...t.map(i=>pt.call(this,i)))),b("tr",`${k}-standard-colors`).children(...Sr.map(t=>pt.call(this,t)))));this.el.child(e)}}class zt extends ae{constructor(e,t){const i=new Q(e).css("height","16px").css("border-bottom",`3px solid ${t}`),s=new Cr;s.change=r=>{this.setTitle(r),this.change(r)},super(i,"auto",!1,"bottom-left",s.el)}setTitle(e){this.title.css("border-color",e),this.hide()}}const kr=[["thin",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" style="user-select: none;"></line></svg>'],["medium",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="2" style="user-select: none;"><line x1="0" y1="1.0" x2="50" y2="1.0" stroke-width="2" stroke="black" style="user-select: none;"></line></svg>'],["thick",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="3" style="user-select: none;"><line x1="0" y1="1.5" x2="50" y2="1.5" stroke-width="3" stroke="black" style="user-select: none;"></line></svg>'],["dashed",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="2" style="user-select: none;"></line></svg>'],["dotted",'<svg xmlns="http://www.w3.org/2000/svg" width="50" height="1" style="user-select: none;"><line x1="0" y1="0.5" x2="50" y2="0.5" stroke-width="1" stroke="black" stroke-dasharray="1" style="user-select: none;"></line></svg>']];class Tr extends ae{constructor(e){const t=new Q("line-type");let i=0;const s=kr.map((r,l)=>b("div",`${k}-item state ${e===r[0]?"checked":""}`).on("click",()=>{s[i].toggle("checked"),s[l].toggle("checked"),i=l,this.hide(),this.change(r)}).child(b("div",`${k}-line-type`).html(r[1])));super(t,"auto",!1,"bottom-left",...s)}}function Ei(...n){return b("table","").child(b("tbody","").children(...n))}function Si(n){return b("td","").child(b("div",`${k}-border-palette-cell`).child(new Q(`border-${n}`)).on("click",()=>{this.mode=n;const{mode:e,style:t,color:i}=this;this.change({mode:e,style:t,color:i})}))}class Ir{constructor(){this.color="#000",this.style="thin",this.mode="all",this.change=()=>{},this.ddColor=new zt("line-color",this.color),this.ddColor.change=t=>{this.color=t},this.ddType=new Tr(this.style),this.ddType.change=([t])=>{this.style=t},this.el=b("div",`${k}-border-palette`);const e=Ei(b("tr","").children(b("td",`${k}-border-palette-left`).child(Ei(b("tr","").children(...["all","inside","horizontal","vertical","outside"].map(t=>Si.call(this,t))),b("tr","").children(...["left","top","right","bottom","none"].map(t=>Si.call(this,t))))),b("td",`${k}-border-palette-right`).children(b("div",`${k}-toolbar-btn`).child(this.ddColor.el),b("div",`${k}-toolbar-btn`).child(this.ddType.el))));this.el.child(e)}}class _r extends ae{constructor(){const e=new Q("border-all"),t=new Ir;t.change=i=>{this.change(i),this.hide()},super(e,"auto",!1,"bottom-left",t.el)}}class Dr extends oe{constructor(){super("border")}dropdown(){return new _r}}class st extends Ot{element(){return super.element().child(new Q(this.tag)).on("click",()=>this.change(this.tag))}setState(e){this.el.disabled(e)}}class $r extends st{constructor(){super("clearformat")}}class Rr extends fe{constructor(){super("paintformat")}setState(){}}class Ar extends oe{constructor(e){super("color",void 0,e)}dropdown(){const{tag:e,value:t}=this;return new zt(e,t)}}class Or extends oe{constructor(e){super("bgcolor",void 0,e)}dropdown(){const{tag:e,value:t}=this;return new zt(e,t)}}class zr extends ae{constructor(){const e=Ct.map(t=>b("div",`${k}-item`).on("click",()=>{this.setTitle(`${t.pt}`),this.change(t)}).child(`${t.pt}`));super("10","60px",!0,"bottom-left",...e)}}let Nr=class extends oe{constructor(){super("font-size")}getValue(e){return e.pt}dropdown(){return new zr}};class Fr extends ae{constructor(){const e=bi.map(t=>b("div",`${k}-item`).on("click",()=>{this.setTitle(t.title),this.change(t)}).child(t.title));super(bi[0].title,"160px",!0,"bottom-left",...e)}}class Mr extends oe{constructor(){super("font-name")}getValue(e){return e.key}dropdown(){return new Fr}}class Br extends ae{constructor(){let e=Oe.slice(0);e.splice(2,0,{key:"divider"}),e.splice(8,0,{key:"divider"}),e=e.map(t=>{const i=b("div",`${k}-item`);return t.key==="divider"?i.addClass("divider"):(i.child(t.title()).on("click",()=>{this.setTitle(t.title()),this.change(t)}),t.label&&i.child(b("div","label").html(t.label))),i}),super("Normal","220px",!0,"bottom-left",...e)}setTitle(e){for(let t=0;t<Oe.length;t+=1)Oe[t].key===e&&this.title.html(Oe[t].title());this.hide()}}let Pr=class extends oe{constructor(){super("format")}getValue(e){return e.key}dropdown(){return new Br}};class Hr extends ae{constructor(){const e=At.map(t=>b("div",`${k}-item`).on("click",()=>{this.hide(),this.change(t)}).child(t.key));super(new Q("formula"),"180px",!0,"bottom-left",...e)}}class Lr extends oe{constructor(){super("formula")}getValue(e){return e.key}dropdown(){return new Hr}}class Wr extends fe{constructor(){super("freeze")}}class Vr extends fe{constructor(){super("merge")}setState(e,t){this.el.active(e).disabled(t)}}class Ur extends st{constructor(){super("redo","Ctrl+Y")}}class Yr extends st{constructor(){super("undo","Ctrl+Z")}}class qr extends st{constructor(){super("print","Ctrl+P")}}class jr extends fe{constructor(){super("textwrap")}}let Xr=class extends ae{constructor(){const e=new Q("ellipsis"),t=b("div",`${k}-toolbar-more`);super(e,"auto",!1,"bottom-right",t),this.moreBtns=t,this.contentEl.css("max-width","420px")}};class Kr extends oe{constructor(){super("more"),this.el.hide()}dropdown(){return new Xr}show(){this.el.show()}hide(){this.el.hide()}}function Ie(){return b("div",`${k}-toolbar-divider`)}function Zr(){this.btns2=[],this.items.forEach(n=>{if(Array.isArray(n))n.forEach(({el:e})=>{const t=e.box(),{marginLeft:i,marginRight:s}=e.computedStyle();this.btns2.push([e,t.width+parseInt(i,10)+parseInt(s,10)])});else{const e=n.box(),{marginLeft:t,marginRight:i}=n.computedStyle();this.btns2.push([n,e.width+parseInt(t,10)+parseInt(i,10)])}})}function Ci(){const{el:n,btns:e,moreEl:t,btns2:i}=this,{moreBtns:s,contentEl:r}=t.dd;n.css("width",`${this.widthFn()-60}px`);const l=n.box();let o=160,a=12;const f=[],u=[];i.forEach(([h,p],y)=>{o+=p,y===i.length-1||o<l.width?f.push(h):(a+=p,u.push(h))}),e.html("").children(...f),s.html("").children(...u),r.css("width",`${a}px`),u.length>0?t.show():t.hide()}class Gr{constructor(e,t,i=!1){this.data=e,this.change=()=>{},this.widthFn=t,this.isHide=i;const s=e.defaultStyle();this.items=[[this.undoEl=new Yr,this.redoEl=new Ur,new qr,this.paintformatEl=new Rr,this.clearformatEl=new $r],Ie(),[this.formatEl=new Pr],Ie(),[this.fontEl=new Mr,this.fontSizeEl=new Nr],Ie(),[this.boldEl=new vr,this.italicEl=new wr,this.underlineEl=new yr,this.strikeEl=new br,this.textColorEl=new Ar(s.color)],Ie(),[this.fillColorEl=new Or(s.bgcolor),this.borderEl=new Dr,this.mergeEl=new Vr],Ie(),[this.alignEl=new gr(s.align),this.valignEl=new pr(s.valign),this.textwrapEl=new jr],Ie(),[this.freezeEl=new Wr,this.autofilterEl=new mr,this.formulaEl=new Lr,this.moreEl=new Kr]],this.el=b("div",`${k}-toolbar`),this.btns=b("div",`${k}-toolbar-btns`),this.items.forEach(r=>{Array.isArray(r)?r.forEach(l=>{this.btns.child(l.el),l.change=(...o)=>{this.change(...o)}}):this.btns.child(r.el)}),this.el.child(this.btns),i?this.el.hide():(this.reset(),setTimeout(()=>{Zr.call(this),Ci.call(this)},0),ie(window,"resize",()=>{Ci.call(this)}))}paintformatActive(){return this.paintformatEl.active()}paintformatToggle(){this.paintformatEl.toggle()}trigger(e){this[`${e}El`].click()}resetData(e){this.data=e,this.reset()}reset(){if(this.isHide)return;const{data:e}=this,t=e.getSelectedCellStyle();this.undoEl.setState(!e.canUndo()),this.redoEl.setState(!e.canRedo()),this.mergeEl.setState(e.canUnmerge(),!e.selector.multiple()),this.autofilterEl.setState(!e.canAutofilter());const{font:i,format:s}=t;this.formatEl.setState(s),this.fontEl.setState(i.name),this.fontSizeEl.setState(i.size),this.boldEl.setState(i.bold),this.italicEl.setState(i.italic),this.underlineEl.setState(t.underline),this.strikeEl.setState(t.strike),this.textColorEl.setState(t.color),this.fillColorEl.setState(t.bgcolor),this.alignEl.setState(t.align),this.valignEl.setState(t.valign),this.textwrapEl.setState(t.textwrap),this.freezeEl.setState(e.freezeIsActive())}}class Jr{constructor(e,t,i="600px"){this.title=e,this.el=b("div",`${k}-modal`).css("width",i).children(b("div",`${k}-modal-header`).children(new Q("close").on("click.stop",()=>this.hide()),this.title),b("div",`${k}-modal-content`).children(...t)).hide()}show(){this.dimmer=b("div",`${k}-dimmer active`),document.body.appendChild(this.dimmer.el);const{width:e,height:t}=this.el.show().box(),{clientHeight:i,clientWidth:s}=document.documentElement;this.el.offset({left:(s-e)/2,top:(i-t)/3}),window.xkeydownEsc=r=>{r.keyCode===27&&this.hide()},ie(window,"keydown",window.xkeydownEsc)}hide(){this.el.hide(),document.body.removeChild(this.dimmer.el),Je(window,"keydown",window.xkeydownEsc),delete window.xkeydownEsc}}class _e{constructor(e,t){this.vchange=()=>{},this.el=b("div",`${k}-form-input`),this.input=b("input","").css("width",e).on("input",i=>this.vchange(i)).attr("placeholder",t),this.el.child(this.input)}focus(){setTimeout(()=>{this.input.el.focus()},10)}hint(e){this.input.attr("placeholder",e)}val(e){return this.input.val(e)}}class mt{constructor(e,t,i,s=l=>l,r=()=>{}){this.key=e,this.getTitle=s,this.vchange=()=>{},this.el=b("div",`${k}-form-select`),this.suggest=new Li(t.map(l=>({key:l,title:this.getTitle(l)})),l=>{this.itemClick(l.key),r(l.key),this.vchange(l.key)},i,this.el),this.el.children(this.itemEl=b("div","input-text").html(this.getTitle(e)),this.suggest.el).on("click",()=>this.show())}show(){this.suggest.search("")}itemClick(e){this.key=e,this.itemEl.html(this.getTitle(e))}val(e){return e!==void 0?(this.key=e,this.itemEl.html(this.getTitle(e)),this):this.key}}const Qr={number:/(^\d+$)|(^\d+(\.\d{0,4})?$)/,date:/^\d{4}-\d{1,2}-\d{1,2}$/};class ge{constructor(e,t,i,s){this.label="",this.rule=t,i&&(this.label=b("label","label").css("width",`${s}px`).html(i)),this.tip=b("div","tip").child("tip").hide(),this.input=e,this.input.vchange=()=>this.validate(),this.el=b("div",`${k}-form-field`).children(this.label,e.el,this.tip)}isShow(){return this.el.css("display")!=="none"}show(){this.el.show()}hide(){return this.el.hide(),this}val(e){return this.input.val(e)}hint(e){this.input.hint(e)}validate(){const{input:e,rule:t,tip:i,el:s}=this,r=e.val();return t.required&&/^\s*$/.test(r)?(i.html(K("validation.required")),s.addClass("error"),!1):(t.type||t.pattern)&&!(t.pattern||Qr[t.type]).test(r)?(i.html(K("validation.notMatch")),s.addClass("error"),!1):(s.removeClass("error"),!0)}}const ki=100;class el extends Jr{constructor(){const e=new ge(new mt("cell",["cell"],"100%",f=>K(`dataValidation.modeType.${f}`)),{required:!0},`${K("dataValidation.range")}:`,ki),t=new ge(new _e("120px","E3 or E3:F12"),{required:!0,pattern:/^([A-Z]{1,2}[1-9]\d*)(:[A-Z]{1,2}[1-9]\d*)?$/}),i=new ge(new mt("list",["list","number","date","phone","email"],"100%",f=>K(`dataValidation.type.${f}`),f=>this.criteriaSelected(f)),{required:!0},`${K("dataValidation.criteria")}:`,ki),s=new ge(new mt("be",["be","nbe","eq","neq","lt","lte","gt","gte"],"160px",f=>K(`dataValidation.operator.${f}`),f=>this.criteriaOperatorSelected(f)),{required:!0}).hide(),r=new ge(new _e("70px","10"),{required:!0}).hide(),l=new ge(new _e("70px","100"),{required:!0,type:"number"}).hide(),o=new ge(new _e("120px","a,b,c"),{required:!0}),a=new ge(new _e("70px","10"),{required:!0,type:"number"}).hide();super(K("contextmenu.validation"),[b("div",`${k}-form-fields`).children(e.el,t.el),b("div",`${k}-form-fields`).children(i.el,s.el,r.el,l.el,a.el,o.el),b("div",`${k}-buttons`).children(new be("cancel").on("click",()=>this.btnClick("cancel")),new be("remove").on("click",()=>this.btnClick("remove")),new be("save","primary").on("click",()=>this.btnClick("save")))]),this.mf=e,this.rf=t,this.cf=i,this.of=s,this.minvf=r,this.maxvf=l,this.vf=a,this.svf=o,this.change=()=>{}}showVf(e){const t=e==="date"?"2018-11-12":"10",{vf:i}=this;i.input.hint(t),i.show()}criteriaSelected(e){const{of:t,minvf:i,maxvf:s,vf:r,svf:l}=this;e==="date"||e==="number"?(t.show(),i.rule.type=e,s.rule.type=e,e==="date"?(i.hint("2018-11-12"),s.hint("2019-11-12")):(i.hint("10"),s.hint("100")),i.show(),s.show(),r.hide(),l.hide()):(e==="list"?l.show():l.hide(),r.hide(),t.hide(),i.hide(),s.hide())}criteriaOperatorSelected(e){if(!e)return;const{minvf:t,maxvf:i,vf:s}=this;if(e==="be"||e==="nbe")t.show(),i.show(),s.hide();else{const r=this.cf.val();s.rule.type=r,r==="date"?s.hint("2018-11-12"):s.hint("10"),s.show(),t.hide(),i.hide()}}btnClick(e){if(e==="cancel")this.hide();else if(e==="remove")this.change("remove"),this.hide();else if(e==="save"){const t=["mf","rf","cf","of","svf","vf","minvf","maxvf"];for(let a=0;a<t.length;a+=1){const f=this[t[a]];if(f.isShow()&&!f.validate())return}const i=this.mf.val(),s=this.rf.val(),r=this.cf.val(),l=this.of.val();let o=this.svf.val();(r==="number"||r==="date")&&(l==="be"||l==="nbe"?o=[this.minvf.val(),this.maxvf.val()]:o=this.vf.val()),this.change("save",i,s,{type:r,operator:l,required:!1,value:o}),this.hide()}}setValue(e){if(e){const{mf:t,rf:i,cf:s,of:r,svf:l,vf:o,minvf:a,maxvf:f}=this,{mode:u,ref:h,validator:p}=e,{type:y,operator:x,value:T}=p||{type:"list"};t.val(u||"cell"),i.val(h),s.val(y),r.val(x),Array.isArray(T)?(a.val(T[0]),f.val(T[1])):(l.val(T||""),o.val(T||"")),this.criteriaSelected(y),this.criteriaOperatorSelected(x)}this.show()}}function Ki(n){return b("div",`${k}-item ${n}`)}function Ti(n){return Ki("state").child(K(`sort.${n}`)).on("click.stop",()=>this.itemClick(n))}function tl(n){const{filterbEl:e,filterValues:t}=this;e.html(""),Object.keys(n).forEach((s,r)=>{const l=n[s],o=t.includes(s)?"checked":"";e.child(b("div",`${k}-item state ${o}`).on("click.stop",()=>this.filterClick(r,s)).children(s===""?K("filter.empty"):s,b("div","label").html(`(${l})`)))})}function Ii(){const{filterhEl:n,filterValues:e,values:t}=this;n.html(`${e.length} / ${t.length}`),n.checked(e.length===t.length)}class il{constructor(){this.filterbEl=b("div",`${k}-body`),this.filterhEl=b("div",`${k}-header state`).on("click.stop",()=>this.filterClick(0,"all")),this.el=b("div",`${k}-sort-filter`).children(this.sortAscEl=Ti.call(this,"asc"),this.sortDescEl=Ti.call(this,"desc"),Ki("divider"),b("div",`${k}-filter`).children(this.filterhEl,this.filterbEl),b("div",`${k}-buttons`).children(new be("cancel").on("click",()=>this.btnClick("cancel")),new be("ok","primary").on("click",()=>this.btnClick("ok")))).hide(),this.ci=null,this.sortDesc=null,this.values=null,this.filterValues=[]}btnClick(e){if(e==="ok"){const{ci:t,sort:i,filterValues:s}=this;this.ok&&this.ok(t,i,"in",s)}this.hide()}itemClick(e){this.sort=e;const{sortAscEl:t,sortDescEl:i}=this;t.checked(e==="asc"),i.checked(e==="desc")}filterClick(e,t){const{filterbEl:i,filterValues:s,values:r}=this,l=i.children();t==="all"?l.length===s.length?(this.filterValues=[],l.forEach(o=>b(o).checked(!1))):(this.filterValues=Array.from(r),l.forEach(o=>b(o).checked(!0))):b(l[e]).toggle("checked")?s.push(t):s.splice(s.findIndex(a=>a===t),1),Ii.call(this)}set(e,t,i,s){this.ci=e;const{sortAscEl:r,sortDescEl:l}=this;s!==null?(this.sort=s.order,r.checked(s.asc()),l.checked(s.desc())):(this.sortDesc=null,r.checked(!1),l.checked(!1)),this.values=Object.keys(t),this.filterValues=i?Array.from(i.value):Object.keys(t),tl.call(this,t,i),Ii.call(this)}setOffset(e){this.el.offset(e).show();let t=1;Fe(this.el,()=>{t<=0&&this.hide(),t-=1})}show(){this.el.show()}hide(){this.el.hide(),De(this.el)}}function Zi(n,e){const t=b("div",`${k}-toast`),i=b("div",`${k}-dimmer active`),s=()=>{document.body.removeChild(t.el),document.body.removeChild(i.el)};t.children(b("div",`${k}-toast-header`).children(new Q("close").on("click.stop",()=>s()),n),b("div",`${k}-toast-content`).html(e)),document.body.appendChild(t.el),document.body.appendChild(i.el);const{width:r,height:l}=t.box(),{clientHeight:o,clientWidth:a}=document.documentElement;t.offset({left:(a-r)/2,top:(o-l)/3})}function vt(n,e){let t;return(...i)=>{const s=this,r=i;t||(t=setTimeout(()=>{t=null,n.apply(s,r)},e))}}function sl(){const{data:n,verticalScrollbar:e,horizontalScrollbar:t}=this,{l:i,t:s,left:r,top:l,width:o,height:a}=n.getSelectedRect(),f=this.getTableOffset();if(Math.abs(r)+o>f.width)t.move({left:i+o-f.width});else{const u=n.freezeTotalWidth();r<u&&t.move({left:i-1-u})}if(Math.abs(l)+a>f.height)e.move({top:s+a-f.height-1});else{const u=n.freezeTotalHeight();l<u&&e.move({top:s-1-u})}}function ye(n,e,t,i=!0,s=!1){if(e===-1&&t===-1)return;const{table:r,selector:l,toolbar:o,data:a,contextMenu:f}=this;f.setMode(e===-1||t===-1?"row-col":"range");const u=a.getCell(e,t);n?(l.setEnd(e,t,s),this.trigger("cells-selected",u,l.range)):(l.set(e,t,i),this.trigger("cell-selected",u,e,t)),o.reset(),r.render()}function le(n,e){const{selector:t,data:i}=this,{rows:s,cols:r}=i;let[l,o]=t.indexes;const{eri:a,eci:f}=t.range;n&&([l,o]=t.moveIndexes),e==="left"?o>0&&(o-=1):e==="right"?(f!==o&&(o=f),o<r.len-1&&(o+=1)):e==="up"?l>0&&(l-=1):e==="down"?(a!==l&&(l=a),l<s.len-1&&(l+=1)):e==="row-first"?o=0:e==="row-last"?o=r.len-1:e==="col-first"?l=0:e==="col-last"&&(l=s.len-1),n&&(t.moveIndexes=[l,o]),ye.call(this,n,l,o),sl.call(this)}function nl(n){if(n.buttons!==0||n.target.className===`${k}-resizer-hover`)return;const{offsetX:e,offsetY:t}=n,{rowResizer:i,colResizer:s,tableEl:r,data:l}=this,{rows:o,cols:a}=l;if(e>a.indexWidth&&t>o.height){i.hide(),s.hide();return}const f=r.box(),u=l.getCellRectByXY(n.offsetX,n.offsetY);u.ri>=0&&u.ci===-1?(u.width=a.indexWidth,i.show(u,{width:f.width}),o.isHide(u.ri-1)?i.showUnhide(u.ri):i.hideUnhide()):i.hide(),u.ri===-1&&u.ci>=0?(u.height=o.height,s.show(u,{height:f.height}),a.isHide(u.ci-1)?s.showUnhide(u.ci):s.hideUnhide()):s.hide()}function rl(n){const{verticalScrollbar:e,horizontalScrollbar:t,data:i}=this,{top:s}=e.scroll(),{left:r}=t.scroll(),{rows:l,cols:o}=i,{deltaY:a,deltaX:f}=n,u=($,R)=>{let O=$,z=0;do z=R(O),O+=1;while(z<=0);return z},h=$=>{if($>0){const R=i.scroll.ri+1;if(R<l.len){const O=u(R,z=>l.getHeight(z));e.move({top:s+O-1})}}else{const R=i.scroll.ri-1;if(R>=0){const O=u(R,z=>l.getHeight(z));e.move({top:R===0?0:s-O})}}},p=$=>{if($>0){const R=i.scroll.ci+1;if(R<o.len){const O=u(R,z=>o.getWidth(z));t.move({left:r+O-1})}}else{const R=i.scroll.ci-1;if(R>=0){const O=u(R,z=>o.getWidth(z));t.move({left:R===0?0:r-O})}}},y=Math.abs(a),x=Math.abs(f),T=Math.max(y,x);/Firefox/i.test(window.navigator.userAgent)&&vt(h(n.detail),50),T===x&&vt(p(f),50),T===y&&vt(h(a),50)}function ll(n,e){const{verticalScrollbar:t,horizontalScrollbar:i}=this,{top:s}=t.scroll(),{left:r}=i.scroll();n==="left"||n==="right"?i.move({left:r-e}):(n==="up"||n==="down")&&t.move({top:s-e})}function Nt(){const{data:n,verticalScrollbar:e}=this,{height:t}=this.getTableOffset(),i=n.exceptRowTotalHeight(0,-1);e.set(t,n.rows.totalHeight()-i)}function Ft(){const{data:n,horizontalScrollbar:e}=this,{width:t}=this.getTableOffset();n&&e.set(t,n.cols.totalWidth())}function ol(){const{selector:n,data:e,editor:t}=this,[i,s]=e.freeze;if(i>0||s>0){const r=e.freezeTotalWidth(),l=e.freezeTotalHeight();t.setFreezeLengths(r,l)}n.resetAreaOffset()}function te(){const{tableEl:n,overlayerEl:e,overlayerCEl:t,table:i,toolbar:s,selector:r,el:l}=this,o=this.getTableOffset(),a=this.getRect();n.attr(a),e.offset(a),t.offset(o),l.css("width",`${a.width}px`),Nt.call(this),Ft.call(this),ol.call(this),i.render(),s.reset(),r.reset()}function Me(){const{data:n,selector:e}=this;n.clearClipboard(),e.hideClipboard()}function Tt(){const{data:n,selector:e}=this;n.copy(),n.copyToSystemClipboard(),e.showClipboard()}function _i(){const{data:n,selector:e}=this;n.cut(),e.showClipboard()}function ze(n,e){const{data:t}=this;if(t.settings.mode!=="read"){if(t.paste(n,i=>Zi("Tip",i)))te.call(this);else if(e){const i=e.clipboardData.getData("text/plain");this.data.pasteFromText(i),te.call(this)}}}function al(){this.data.hideRowsOrCols(),te.call(this)}function Di(n,e){this.data.unhideRowsOrCols(n,e),te.call(this)}function cl(){const{data:n}=this;n.autofilter(),te.call(this)}function hl(){const{toolbar:n}=this;n.paintformatActive()&&(ze.call(this,"format"),Me.call(this),n.paintformatToggle())}function $i(n){const{selector:e,data:t,table:i,sortFilter:s}=this,{offsetX:r,offsetY:l}=n,o=n.target.className===`${k}-selector-corner`,a=t.getCellRectByXY(r,l),{left:f,top:u,width:h,height:p}=a;let{ri:y,ci:x}=a;const{autoFilter:T}=t;if(T.includes(y,x)&&f+h-20<r&&u+p-20<l){const $=T.items(x,(R,O)=>t.rows.getCell(R,O));s.hide(),s.set(x,$,T.getFilter(x),T.getSort(x)),s.setOffset({left:f,top:u+p+2});return}n.shiftKey||(o?e.showAutofill(y,x):ye.call(this,!1,y,x),Fi(window,$=>{({ri:y,ci:x}=t.getCellRectByXY($.offsetX,$.offsetY)),o?e.showAutofill(y,x):$.buttons===1&&!$.shiftKey&&ye.call(this,!0,y,x,!0,!0)},()=>{o&&e.arange&&t.settings.mode!=="read"&&t.autofill(e.arange,"all",$=>Zi("Tip",$))&&i.render(),e.hideAutofill(),hl.call(this)})),!o&&n.buttons===1&&n.shiftKey&&ye.call(this,!0,y,x)}function Be(){const{editor:n,data:e}=this,t=e.getSelectedRect(),i=this.getTableOffset();let s="top";t.top>i.height/2&&(s="bottom"),n.setOffset(t,s)}function Ne(){const{editor:n,data:e}=this;e.settings.mode!=="read"&&(Be.call(this),n.setCell(e.getSelectedCell(),e.getSelectedValidator()),Me.call(this))}function fl(n){const{data:e,table:t,selector:i}=this;e.scrolly(n,()=>{i.resetBRLAreaOffset(),Be.call(this),t.render()})}function dl(n){const{data:e,table:t,selector:i}=this;e.scrollx(n,()=>{i.resetBRTAreaOffset(),Be.call(this),t.render()})}function ul(n,e){const{ri:t}=n,{table:i,selector:s,data:r}=this;r.rows.setHeight(t,e),i.render(),s.resetAreaOffset(),Nt.call(this),Be.call(this)}function gl(n,e){const{ci:t}=n,{table:i,selector:s,data:r}=this;r.cols.setWidth(t,e),i.render(),s.resetAreaOffset(),Ft.call(this),Be.call(this)}function wt(n,e="finished"){const{data:t,table:i}=this;if(t.settings.mode==="read")return;t.setSelectedCellText(n,e);const{ri:s,ci:r}=t.selector;e==="finished"?i.render():this.trigger("cell-edited",n,s,r)}function Ze(n){const{data:e}=this;e.settings.mode!=="read"&&(n==="insert-row"?e.insert("row"):n==="delete-row"?e.delete("row"):n==="insert-column"?e.insert("column"):n==="delete-column"?e.delete("column"):n==="delete-cell"?e.deleteCell():n==="delete-cell-format"?e.deleteCell("format"):n==="delete-cell-text"?e.deleteCell("text"):n==="cell-printable"?e.setSelectedCellAttr("printable",!0):n==="cell-non-printable"?e.setSelectedCellAttr("printable",!1):n==="cell-editable"?e.setSelectedCellAttr("editable",!0):n==="cell-non-editable"&&e.setSelectedCellAttr("editable",!1),Me.call(this),te.call(this))}function pl(n,e){const{data:t}=this;if(n==="undo")this.undo();else if(n==="redo")this.redo();else if(n==="print")this.print.preview();else if(n==="paintformat")e===!0?Tt.call(this):Me.call(this);else if(n==="clearformat")Ze.call(this,"delete-cell-format");else if(n!=="link"){if(n!=="chart")if(n==="autofilter")cl.call(this);else if(n==="freeze")if(e){const{ri:i,ci:s}=t.selector;this.freeze(i,s)}else this.freeze(0,0);else t.setSelectedCellAttr(n,e),n==="formula"&&!t.selector.multiple()&&Ne.call(this),te.call(this)}}function ml(n,e,t,i){this.data.setAutoFilter(n,e,t,i),te.call(this)}function vl(){const{selector:n,overlayerEl:e,rowResizer:t,colResizer:i,verticalScrollbar:s,horizontalScrollbar:r,editor:l,contextMenu:o,toolbar:a,modalValidation:f,sortFilter:u}=this;e.on("mousemove",h=>{nl.call(this,h)}).on("mousedown",h=>{l.clear(),o.hide(),h.buttons===2?(this.data.xyInSelectedRect(h.offsetX,h.offsetY)||$i.call(this,h),o.setPosition(h.offsetX,h.offsetY),h.stopPropagation()):h.detail===2?Ne.call(this):$i.call(this,h)}).on("mousewheel.stop",h=>{rl.call(this,h)}).on("mouseout",h=>{const{offsetX:p,offsetY:y}=h;y<=0&&i.hide(),p<=0&&t.hide()}),n.inputChange=h=>{wt.call(this,h,"input"),Ne.call(this)},Cn(e.el,{move:(h,p)=>{ll.call(this,h,p)}}),a.change=(h,p)=>pl.call(this,h,p),u.ok=(h,p,y,x)=>ml.call(this,h,p,y,x),t.finishedFn=(h,p)=>{ul.call(this,h,p)},i.finishedFn=(h,p)=>{gl.call(this,h,p)},t.unhideFn=h=>{Di.call(this,"row",h)},i.unhideFn=h=>{Di.call(this,"col",h)},s.moveFn=(h,p)=>{fl.call(this,h,p)},r.moveFn=(h,p)=>{dl.call(this,h,p)},l.change=(h,p)=>{wt.call(this,p,h)},f.change=(h,...p)=>{h==="save"?this.data.addValidation(...p):this.data.removeValidation()},o.itemClick=h=>{h==="validation"?f.setValue(this.data.getSelectedValidation()):h==="copy"?Tt.call(this):h==="cut"?_i.call(this):h==="paste"?ze.call(this,"all"):h==="paste-value"?ze.call(this,"text"):h==="paste-format"?ze.call(this,"format"):h==="hide"?al.call(this):Ze.call(this,h)},ie(window,"resize",()=>{this.reload()}),ie(window,"click",h=>{this.focusing=e.contains(h.target)}),ie(window,"paste",h=>{this.focusing&&(ze.call(this,"all",h),h.preventDefault())}),ie(window,"keydown",h=>{if(!this.focusing)return;const p=h.keyCode||h.which,{key:y,ctrlKey:x,shiftKey:T,metaKey:$}=h;if(x||$)switch(p){case 90:this.undo(),h.preventDefault();break;case 89:this.redo(),h.preventDefault();break;case 67:Tt.call(this),h.preventDefault();break;case 88:_i.call(this),h.preventDefault();break;case 85:a.trigger("underline"),h.preventDefault();break;case 86:break;case 37:le.call(this,T,"row-first"),h.preventDefault();break;case 38:le.call(this,T,"col-first"),h.preventDefault();break;case 39:le.call(this,T,"row-last"),h.preventDefault();break;case 40:le.call(this,T,"col-last"),h.preventDefault();break;case 32:ye.call(this,!1,-1,this.data.selector.ci,!1),h.preventDefault();break;case 66:a.trigger("bold");break;case 73:a.trigger("italic");break}else{switch(p){case 32:T&&ye.call(this,!1,this.data.selector.ri,-1,!1);break;case 27:o.hide(),Me.call(this);break;case 37:le.call(this,T,"left"),h.preventDefault();break;case 38:le.call(this,T,"up"),h.preventDefault();break;case 39:le.call(this,T,"right"),h.preventDefault();break;case 40:le.call(this,T,"down"),h.preventDefault();break;case 9:l.clear(),le.call(this,!1,T?"left":"right"),h.preventDefault();break;case 13:l.clear(),le.call(this,!1,T?"up":"down"),h.preventDefault();break;case 8:Ze.call(this,"delete-cell-text"),h.preventDefault();break}y==="Delete"?(Ze.call(this,"delete-cell-text"),h.preventDefault()):p>=65&&p<=90||p>=48&&p<=57||p>=96&&p<=105||h.key==="="?(wt.call(this,h.key,"input"),Ne.call(this)):p===113&&Ne.call(this)}})}class wl{constructor(e,t){this.eventMap=kn();const{view:i,showToolbar:s,showContextmenu:r}=t.settings;this.el=b("div",`${k}-sheet`),this.toolbar=new Gr(t,i.width,!s),this.print=new or(t),e.children(this.toolbar.el,this.el,this.print.el),this.data=t,this.tableEl=b("canvas",`${k}-table`),this.rowResizer=new di(!1,t.rows.height),this.colResizer=new di(!0,t.cols.minWidth),this.verticalScrollbar=new ui(!0),this.horizontalScrollbar=new ui(!1),this.editor=new Vn(Zn,()=>this.getTableOffset(),t.rows.height),this.modalValidation=new el,this.contextMenu=new fr(()=>this.getRect(),!r),this.selector=new _n(t),this.overlayerCEl=b("div",`${k}-overlayer-content`).children(this.editor.el,this.selector.el),this.overlayerEl=b("div",`${k}-overlayer`).child(this.overlayerCEl),this.sortFilter=new il,this.el.children(this.tableEl,this.overlayerEl.el,this.rowResizer.el,this.colResizer.el,this.verticalScrollbar.el,this.horizontalScrollbar.el,this.contextMenu.el,this.modalValidation.el,this.sortFilter.el),this.table=new nr(this.tableEl.el,t),vl.call(this),te.call(this),ye.call(this,!1,0,0)}on(e,t){return this.eventMap.on(e,t),this}trigger(e,...t){const{eventMap:i}=this;i.fire(e,t)}resetData(e){this.editor.clear(),this.data=e,Nt.call(this),Ft.call(this),this.toolbar.resetData(e),this.print.resetData(e),this.selector.resetData(e),this.table.resetData(e)}loadData(e){return this.data.setData(e),te.call(this),this}freeze(e,t){const{data:i}=this;return i.setFreeze(e,t),te.call(this),this}undo(){this.data.undo(),te.call(this)}redo(){this.data.redo(),te.call(this)}reload(){return te.call(this),this}getRect(){const{data:e}=this;return{width:e.viewWidth(),height:e.viewHeight()}}getTableOffset(){const{rows:e,cols:t}=this.data,{width:i,height:s}=this.getRect();return{width:i-t.indexWidth,height:s-e.height,left:t.indexWidth,top:e.height}}}class bl extends ae{constructor(e){const t=new Q("ellipsis");super(t,"auto",!1,"top-left"),this.contentClick=e}reset(e){const t=e.map((i,s)=>b("div",`${k}-item`).css("width","150px").css("font-weight","normal").on("click",()=>{this.contentClick(s),this.hide()}).child(i));this.setContentChildren(...t)}setTitle(){}}const yl=[{key:"delete",title:L("contextmenu.deleteSheet")}];function xl(n){return b("div",`${k}-item`).child(n.title()).on("click",()=>{this.itemClick(n.key),this.hide()})}function El(){return yl.map(n=>xl.call(this,n))}class Sl{constructor(){this.el=b("div",`${k}-contextmenu`).css("width","160px").children(...El.call(this)).hide(),this.itemClick=()=>{}}hide(){const{el:e}=this;e.hide(),De(e)}setOffset(e){const{el:t}=this;t.offset(e),t.show(),Fe(t)}}class Cl{constructor(e=()=>{},t=()=>{},i=()=>{},s=()=>{}){this.swapFunc=t,this.updateFunc=s,this.dataNames=[],this.activeEl=null,this.deleteEl=null,this.items=[],this.moreEl=new bl(r=>{this.clickSwap2(this.items[r])}),this.contextMenu=new Sl,this.contextMenu.itemClick=i,this.el=b("div",`${k}-bottombar`).children(this.contextMenu.el,this.menuEl=b("ul",`${k}-menu`).child(b("li","").children(new Q("add").on("click",()=>{e()}),b("span","").child(this.moreEl))))}addItem(e,t){this.dataNames.push(e);const i=b("li",t?"active":"").child(e);i.on("click",()=>{this.clickSwap2(i)}).on("contextmenu",s=>{const{offsetLeft:r,offsetHeight:l}=s.target;this.contextMenu.setOffset({left:r,bottom:l+1}),this.deleteEl=i}).on("dblclick",()=>{const s=i.html(),r=new _e("auto","");r.val(s),r.input.on("blur",({target:l})=>{const{value:o}=l,a=this.dataNames.findIndex(f=>f===s);this.renameItem(a,o)}),i.html("").child(r.el),r.focus()}),t&&this.clickSwap(i),this.items.push(i),this.menuEl.child(i),this.moreEl.reset(this.dataNames)}renameItem(e,t){this.dataNames.splice(e,1,t),this.moreEl.reset(this.dataNames),this.items[e].html("").child(t),this.updateFunc(e,t)}clear(){this.items.forEach(e=>{this.menuEl.removeChild(e.el)}),this.items=[],this.dataNames=[],this.moreEl.reset(this.dataNames)}deleteItem(){const{activeEl:e,deleteEl:t}=this;if(this.items.length>1){const i=this.items.findIndex(s=>s===t);if(this.items.splice(i,1),this.dataNames.splice(i,1),this.menuEl.removeChild(t.el),this.moreEl.reset(this.dataNames),e===t){const[s]=this.items;return this.activeEl=s,this.activeEl.toggle(),[i,0]}return[i,-1]}return[-1]}clickSwap2(e){const t=this.items.findIndex(i=>i===e);this.clickSwap(e),this.activeEl.toggle(),this.swapFunc(t)}clickSwap(e){this.activeEl!==null&&this.activeEl.toggle(),this.activeEl=e}}class kl{constructor(e,t={}){let i=e;this.options={showBottomBar:!0,...t},this.sheetIndex=1,this.datas=[],typeof e=="string"&&(i=document.querySelector(e)),this.bottombar=this.options.showBottomBar?new Cl(()=>{const r=this.addSheet();this.sheet.resetData(r)},r=>{const l=this.datas[r];this.sheet.resetData(l)},()=>{this.deleteSheet()},(r,l)=>{this.datas[r].name=l}):null,this.data=this.addSheet();const s=b("div",`${k}`).on("contextmenu",r=>r.preventDefault());i.appendChild(s.el),this.sheet=new wl(s,this.data),this.bottombar!==null&&s.child(this.bottombar.el)}addSheet(e,t=!0){const i=e||`sheet${this.sheetIndex}`,s=new Sn(i,this.options);return s.change=(...r)=>{this.sheet.trigger("change",...r)},this.datas.push(s),this.bottombar!==null&&this.bottombar.addItem(i,t),this.sheetIndex+=1,s}deleteSheet(){if(this.bottombar===null)return;const[e,t]=this.bottombar.deleteItem();e>=0&&(this.datas.splice(e,1),t>=0&&this.sheet.resetData(this.datas[t]))}loadData(e){const t=Array.isArray(e)?e:[e];if(this.bottombar!==null&&this.bottombar.clear(),this.datas=[],t.length>0)for(let i=0;i<t.length;i+=1){const s=t[i],r=this.addSheet(s.name,i===0);r.setData(s),i===0&&this.sheet.resetData(r)}return this}getData(){return this.datas.map(e=>e.getData())}cellText(e,t,i,s=0){return this.datas[s].setCellText(e,t,i,"finished"),this}cell(e,t,i=0){return this.datas[i].getCell(e,t)}cellStyle(e,t,i=0){return this.datas[i].getCellStyle(e,t)}reRender(){return this.sheet.table.render(),this}on(e,t){return this.sheet.on(e,t),this}validate(){const{validations:e}=this.data;return e.errors.size<=0}change(e){return this.sheet.on("change",e),this}static locale(e,t){zi(e,t)}}const Tl=(n,e={})=>new kl(n,e);window&&(window.x_spreadsheet=Tl,window.x_spreadsheet.locale=(n,e)=>zi(n,e));function Xe(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Gi={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,s,r){function l(f,u){if(!s[f]){if(!i[f]){var h=typeof Xe=="function"&&Xe;if(!u&&h)return h(f,!0);if(o)return o(f,!0);var p=new Error("Cannot find module '"+f+"'");throw p.code="MODULE_NOT_FOUND",p}var y=s[f]={exports:{}};i[f][0].call(y.exports,function(x){var T=i[f][1][x];return l(T||x)},y,y.exports,t,i,s,r)}return s[f].exports}for(var o=typeof Xe=="function"&&Xe,a=0;a<r.length;a++)l(r[a]);return l}({1:[function(t,i,s){(function(r){var l=r.MutationObserver||r.WebKitMutationObserver,o;if(l){var a=0,f=new l(x),u=r.document.createTextNode("");f.observe(u,{characterData:!0}),o=function(){u.data=a=++a%2}}else if(!r.setImmediate&&typeof r.MessageChannel<"u"){var h=new r.MessageChannel;h.port1.onmessage=x,o=function(){h.port2.postMessage(0)}}else"document"in r&&"onreadystatechange"in r.document.createElement("script")?o=function(){var $=r.document.createElement("script");$.onreadystatechange=function(){x(),$.onreadystatechange=null,$.parentNode.removeChild($),$=null},r.document.documentElement.appendChild($)}:o=function(){setTimeout(x,0)};var p,y=[];function x(){p=!0;for(var $,R,O=y.length;O;){for(R=y,y=[],$=-1;++$<O;)R[$]();O=y.length}p=!1}i.exports=T;function T($){y.push($)===1&&!p&&o()}}).call(this,typeof Le<"u"?Le:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(t,i,s){var r=t(1);function l(){}var o={},a=["REJECTED"],f=["FULFILLED"],u=["PENDING"];i.exports=h;function h(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,S!==l&&T(this,S)}h.prototype.catch=function(S){return this.then(null,S)},h.prototype.then=function(S,B){if(typeof S!="function"&&this.state===f||typeof B!="function"&&this.state===a)return this;var F=new this.constructor(l);if(this.state!==u){var P=this.state===f?S:B;y(F,P,this.outcome)}else this.queue.push(new p(F,S,B));return F};function p(S,B,F){this.promise=S,typeof B=="function"&&(this.onFulfilled=B,this.callFulfilled=this.otherCallFulfilled),typeof F=="function"&&(this.onRejected=F,this.callRejected=this.otherCallRejected)}p.prototype.callFulfilled=function(S){o.resolve(this.promise,S)},p.prototype.otherCallFulfilled=function(S){y(this.promise,this.onFulfilled,S)},p.prototype.callRejected=function(S){o.reject(this.promise,S)},p.prototype.otherCallRejected=function(S){y(this.promise,this.onRejected,S)};function y(S,B,F){r(function(){var P;try{P=B(F)}catch(U){return o.reject(S,U)}P===S?o.reject(S,new TypeError("Cannot resolve promise with itself")):o.resolve(S,P)})}o.resolve=function(S,B){var F=$(x,B);if(F.status==="error")return o.reject(S,F.value);var P=F.value;if(P)T(S,P);else{S.state=f,S.outcome=B;for(var U=-1,Y=S.queue.length;++U<Y;)S.queue[U].callFulfilled(B)}return S},o.reject=function(S,B){S.state=a,S.outcome=B;for(var F=-1,P=S.queue.length;++F<P;)S.queue[F].callRejected(B);return S};function x(S){var B=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof B=="function")return function(){B.apply(S,arguments)}}function T(S,B){var F=!1;function P(G){F||(F=!0,o.reject(S,G))}function U(G){F||(F=!0,o.resolve(S,G))}function Y(){B(U,P)}var Z=$(Y);Z.status==="error"&&P(Z.value)}function $(S,B){var F={};try{F.value=S(B),F.status="success"}catch(P){F.status="error",F.value=P}return F}h.resolve=R;function R(S){return S instanceof this?S:o.resolve(new this(l),S)}h.reject=O;function O(S){var B=new this(l);return o.reject(B,S)}h.all=z;function z(S){var B=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=S.length,P=!1;if(!F)return this.resolve([]);for(var U=new Array(F),Y=0,Z=-1,G=new this(l);++Z<F;)J(S[Z],Z);return G;function J(re,ve){B.resolve(re).then(nt,function(Ee){P||(P=!0,o.reject(G,Ee))});function nt(Ee){U[ve]=Ee,++Y===F&&!P&&(P=!0,o.resolve(G,U))}}}h.race=N;function N(S){var B=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var F=S.length,P=!1;if(!F)return this.resolve([]);for(var U=-1,Y=new this(l);++U<F;)Z(S[U]);return Y;function Z(G){B.resolve(G).then(function(J){P||(P=!0,o.resolve(Y,J))},function(J){P||(P=!0,o.reject(Y,J))})}}},{1:1}],3:[function(t,i,s){(function(r){typeof r.Promise!="function"&&(r.Promise=t(2))}).call(this,typeof Le<"u"?Le:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(t,i,s){var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};function l(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}function o(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var a=o();function f(){try{if(!a||!a.open)return!1;var c=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),g=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!c||g)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function u(c,g){c=c||[],g=g||{};try{return new Blob(c,g)}catch(m){if(m.name!=="TypeError")throw m;for(var d=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,v=new d,w=0;w<c.length;w+=1)v.append(c[w]);return v.getBlob(g.type)}}typeof Promise>"u"&&t(3);var h=Promise;function p(c,g){g&&c.then(function(d){g(null,d)},function(d){g(d)})}function y(c,g,d){typeof g=="function"&&c.then(g),typeof d=="function"&&c.catch(d)}function x(c){return typeof c!="string"&&(console.warn(c+" used as a key, but it is not a string."),c=String(c)),c}function T(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var $="local-forage-detect-blob-support",R=void 0,O={},z=Object.prototype.toString,N="readonly",S="readwrite";function B(c){for(var g=c.length,d=new ArrayBuffer(g),v=new Uint8Array(d),w=0;w<g;w++)v[w]=c.charCodeAt(w);return d}function F(c){return new h(function(g){var d=c.transaction($,S),v=u([""]);d.objectStore($).put(v,"key"),d.onabort=function(w){w.preventDefault(),w.stopPropagation(),g(!1)},d.oncomplete=function(){var w=navigator.userAgent.match(/Chrome\/(\d+)/),m=navigator.userAgent.match(/Edge\//);g(m||!w||parseInt(w[1],10)>=43)}}).catch(function(){return!1})}function P(c){return typeof R=="boolean"?h.resolve(R):F(c).then(function(g){return R=g,R})}function U(c){var g=O[c.name],d={};d.promise=new h(function(v,w){d.resolve=v,d.reject=w}),g.deferredOperations.push(d),g.dbReady?g.dbReady=g.dbReady.then(function(){return d.promise}):g.dbReady=d.promise}function Y(c){var g=O[c.name],d=g.deferredOperations.pop();if(d)return d.resolve(),d.promise}function Z(c,g){var d=O[c.name],v=d.deferredOperations.pop();if(v)return v.reject(g),v.promise}function G(c,g){return new h(function(d,v){if(O[c.name]=O[c.name]||Bt(),c.db)if(g)U(c),c.db.close();else return d(c.db);var w=[c.name];g&&w.push(c.version);var m=a.open.apply(a,w);g&&(m.onupgradeneeded=function(E){var C=m.result;try{C.createObjectStore(c.storeName),E.oldVersion<=1&&C.createObjectStore($)}catch(I){if(I.name==="ConstraintError")console.warn('The database "'+c.name+'" has been upgraded from version '+E.oldVersion+" to version "+E.newVersion+', but the storage "'+c.storeName+'" already exists.');else throw I}}),m.onerror=function(E){E.preventDefault(),v(m.error)},m.onsuccess=function(){var E=m.result;E.onversionchange=function(C){C.target.close()},d(E),Y(c)}})}function J(c){return G(c,!1)}function re(c){return G(c,!0)}function ve(c,g){if(!c.db)return!0;var d=!c.db.objectStoreNames.contains(c.storeName),v=c.version<c.db.version,w=c.version>c.db.version;if(v&&(c.version!==g&&console.warn('The database "'+c.name+`" can't be downgraded from version `+c.db.version+" to version "+c.version+"."),c.version=c.db.version),w||d){if(d){var m=c.db.version+1;m>c.version&&(c.version=m)}return!0}return!1}function nt(c){return new h(function(g,d){var v=new FileReader;v.onerror=d,v.onloadend=function(w){var m=btoa(w.target.result||"");g({__local_forage_encoded_blob:!0,data:m,type:c.type})},v.readAsBinaryString(c)})}function Ee(c){var g=B(atob(c.data));return u([g],{type:c.type})}function Mt(c){return c&&c.__local_forage_encoded_blob}function Ji(c){var g=this,d=g._initReady().then(function(){var v=O[g._dbInfo.name];if(v&&v.dbReady)return v.dbReady});return y(d,c,c),d}function Qi(c){U(c);for(var g=O[c.name],d=g.forages,v=0;v<d.length;v++){var w=d[v];w._dbInfo.db&&(w._dbInfo.db.close(),w._dbInfo.db=null)}return c.db=null,J(c).then(function(m){return c.db=m,ve(c)?re(c):m}).then(function(m){c.db=g.db=m;for(var E=0;E<d.length;E++)d[E]._dbInfo.db=m}).catch(function(m){throw Z(c,m),m})}function ce(c,g,d,v){v===void 0&&(v=1);try{var w=c.db.transaction(c.storeName,g);d(null,w)}catch(m){if(v>0&&(!c.db||m.name==="InvalidStateError"||m.name==="NotFoundError"))return h.resolve().then(function(){if(!c.db||m.name==="NotFoundError"&&!c.db.objectStoreNames.contains(c.storeName)&&c.version<=c.db.version)return c.db&&(c.version=c.db.version+1),re(c)}).then(function(){return Qi(c).then(function(){ce(c,g,d,v-1)})}).catch(d);d(m)}}function Bt(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function es(c){var g=this,d={db:null};if(c)for(var v in c)d[v]=c[v];var w=O[d.name];w||(w=Bt(),O[d.name]=w),w.forages.push(g),g._initReady||(g._initReady=g.ready,g.ready=Ji);var m=[];function E(){return h.resolve()}for(var C=0;C<w.forages.length;C++){var I=w.forages[C];I!==g&&m.push(I._initReady().catch(E))}var _=w.forages.slice(0);return h.all(m).then(function(){return d.db=w.db,J(d)}).then(function(D){return d.db=D,ve(d,g._defaultConfig.version)?re(d):D}).then(function(D){d.db=w.db=D,g._dbInfo=d;for(var A=0;A<_.length;A++){var H=_[A];H!==g&&(H._dbInfo.db=d.db,H._dbInfo.version=d.version)}})}function ts(c,g){var d=this;c=x(c);var v=new h(function(w,m){d.ready().then(function(){ce(d._dbInfo,N,function(E,C){if(E)return m(E);try{var I=C.objectStore(d._dbInfo.storeName),_=I.get(c);_.onsuccess=function(){var D=_.result;D===void 0&&(D=null),Mt(D)&&(D=Ee(D)),w(D)},_.onerror=function(){m(_.error)}}catch(D){m(D)}})}).catch(m)});return p(v,g),v}function is(c,g){var d=this,v=new h(function(w,m){d.ready().then(function(){ce(d._dbInfo,N,function(E,C){if(E)return m(E);try{var I=C.objectStore(d._dbInfo.storeName),_=I.openCursor(),D=1;_.onsuccess=function(){var A=_.result;if(A){var H=A.value;Mt(H)&&(H=Ee(H));var W=c(H,A.key,D++);W!==void 0?w(W):A.continue()}else w()},_.onerror=function(){m(_.error)}}catch(A){m(A)}})}).catch(m)});return p(v,g),v}function ss(c,g,d){var v=this;c=x(c);var w=new h(function(m,E){var C;v.ready().then(function(){return C=v._dbInfo,z.call(g)==="[object Blob]"?P(C.db).then(function(I){return I?g:nt(g)}):g}).then(function(I){ce(v._dbInfo,S,function(_,D){if(_)return E(_);try{var A=D.objectStore(v._dbInfo.storeName);I===null&&(I=void 0);var H=A.put(I,c);D.oncomplete=function(){I===void 0&&(I=null),m(I)},D.onabort=D.onerror=function(){var W=H.error?H.error:H.transaction.error;E(W)}}catch(W){E(W)}})}).catch(E)});return p(w,d),w}function ns(c,g){var d=this;c=x(c);var v=new h(function(w,m){d.ready().then(function(){ce(d._dbInfo,S,function(E,C){if(E)return m(E);try{var I=C.objectStore(d._dbInfo.storeName),_=I.delete(c);C.oncomplete=function(){w()},C.onerror=function(){m(_.error)},C.onabort=function(){var D=_.error?_.error:_.transaction.error;m(D)}}catch(D){m(D)}})}).catch(m)});return p(v,g),v}function rs(c){var g=this,d=new h(function(v,w){g.ready().then(function(){ce(g._dbInfo,S,function(m,E){if(m)return w(m);try{var C=E.objectStore(g._dbInfo.storeName),I=C.clear();E.oncomplete=function(){v()},E.onabort=E.onerror=function(){var _=I.error?I.error:I.transaction.error;w(_)}}catch(_){w(_)}})}).catch(w)});return p(d,c),d}function ls(c){var g=this,d=new h(function(v,w){g.ready().then(function(){ce(g._dbInfo,N,function(m,E){if(m)return w(m);try{var C=E.objectStore(g._dbInfo.storeName),I=C.count();I.onsuccess=function(){v(I.result)},I.onerror=function(){w(I.error)}}catch(_){w(_)}})}).catch(w)});return p(d,c),d}function os(c,g){var d=this,v=new h(function(w,m){if(c<0){w(null);return}d.ready().then(function(){ce(d._dbInfo,N,function(E,C){if(E)return m(E);try{var I=C.objectStore(d._dbInfo.storeName),_=!1,D=I.openKeyCursor();D.onsuccess=function(){var A=D.result;if(!A){w(null);return}c===0||_?w(A.key):(_=!0,A.advance(c))},D.onerror=function(){m(D.error)}}catch(A){m(A)}})}).catch(m)});return p(v,g),v}function as(c){var g=this,d=new h(function(v,w){g.ready().then(function(){ce(g._dbInfo,N,function(m,E){if(m)return w(m);try{var C=E.objectStore(g._dbInfo.storeName),I=C.openKeyCursor(),_=[];I.onsuccess=function(){var D=I.result;if(!D){v(_);return}_.push(D.key),D.continue()},I.onerror=function(){w(I.error)}}catch(D){w(D)}})}).catch(w)});return p(d,c),d}function cs(c,g){g=T.apply(this,arguments);var d=this.config();c=typeof c!="function"&&c||{},c.name||(c.name=c.name||d.name,c.storeName=c.storeName||d.storeName);var v=this,w;if(!c.name)w=h.reject("Invalid arguments");else{var m=c.name===d.name&&v._dbInfo.db,E=m?h.resolve(v._dbInfo.db):J(c).then(function(C){var I=O[c.name],_=I.forages;I.db=C;for(var D=0;D<_.length;D++)_[D]._dbInfo.db=C;return C});c.storeName?w=E.then(function(C){if(C.objectStoreNames.contains(c.storeName)){var I=C.version+1;U(c);var _=O[c.name],D=_.forages;C.close();for(var A=0;A<D.length;A++){var H=D[A];H._dbInfo.db=null,H._dbInfo.version=I}var W=new h(function(V,X){var q=a.open(c.name,I);q.onerror=function(se){var Re=q.result;Re.close(),X(se)},q.onupgradeneeded=function(){var se=q.result;se.deleteObjectStore(c.storeName)},q.onsuccess=function(){var se=q.result;se.close(),V(se)}});return W.then(function(V){_.db=V;for(var X=0;X<D.length;X++){var q=D[X];q._dbInfo.db=V,Y(q._dbInfo)}}).catch(function(V){throw(Z(c,V)||h.resolve()).catch(function(){}),V})}}):w=E.then(function(C){U(c);var I=O[c.name],_=I.forages;C.close();for(var D=0;D<_.length;D++){var A=_[D];A._dbInfo.db=null}var H=new h(function(W,V){var X=a.deleteDatabase(c.name);X.onerror=function(){var q=X.result;q&&q.close(),V(X.error)},X.onblocked=function(){console.warn('dropInstance blocked for database "'+c.name+'" until all open connections are closed')},X.onsuccess=function(){var q=X.result;q&&q.close(),W(q)}});return H.then(function(W){I.db=W;for(var V=0;V<_.length;V++){var X=_[V];Y(X._dbInfo)}}).catch(function(W){throw(Z(c,W)||h.resolve()).catch(function(){}),W})})}return p(w,g),w}var hs={_driver:"asyncStorage",_initStorage:es,_support:f(),iterate:is,getItem:ts,setItem:ss,removeItem:ns,clear:rs,length:ls,key:os,keys:as,dropInstance:cs};function fs(){return typeof openDatabase=="function"}var de="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ds="~~local_forage_type~",Pt=/^~~local_forage_type~([^~]+)~/,Pe="__lfsc__:",rt=Pe.length,lt="arbf",ot="blob",Ht="si08",Lt="ui08",Wt="uic8",Vt="si16",Ut="si32",Yt="ur16",qt="ui32",jt="fl32",Xt="fl64",Kt=rt+lt.length,Zt=Object.prototype.toString;function Gt(c){var g=c.length*.75,d=c.length,v,w=0,m,E,C,I;c[c.length-1]==="="&&(g--,c[c.length-2]==="="&&g--);var _=new ArrayBuffer(g),D=new Uint8Array(_);for(v=0;v<d;v+=4)m=de.indexOf(c[v]),E=de.indexOf(c[v+1]),C=de.indexOf(c[v+2]),I=de.indexOf(c[v+3]),D[w++]=m<<2|E>>4,D[w++]=(E&15)<<4|C>>2,D[w++]=(C&3)<<6|I&63;return _}function at(c){var g=new Uint8Array(c),d="",v;for(v=0;v<g.length;v+=3)d+=de[g[v]>>2],d+=de[(g[v]&3)<<4|g[v+1]>>4],d+=de[(g[v+1]&15)<<2|g[v+2]>>6],d+=de[g[v+2]&63];return g.length%3===2?d=d.substring(0,d.length-1)+"=":g.length%3===1&&(d=d.substring(0,d.length-2)+"=="),d}function us(c,g){var d="";if(c&&(d=Zt.call(c)),c&&(d==="[object ArrayBuffer]"||c.buffer&&Zt.call(c.buffer)==="[object ArrayBuffer]")){var v,w=Pe;c instanceof ArrayBuffer?(v=c,w+=lt):(v=c.buffer,d==="[object Int8Array]"?w+=Ht:d==="[object Uint8Array]"?w+=Lt:d==="[object Uint8ClampedArray]"?w+=Wt:d==="[object Int16Array]"?w+=Vt:d==="[object Uint16Array]"?w+=Yt:d==="[object Int32Array]"?w+=Ut:d==="[object Uint32Array]"?w+=qt:d==="[object Float32Array]"?w+=jt:d==="[object Float64Array]"?w+=Xt:g(new Error("Failed to get type for BinaryArray"))),g(w+at(v))}else if(d==="[object Blob]"){var m=new FileReader;m.onload=function(){var E=ds+c.type+"~"+at(this.result);g(Pe+ot+E)},m.readAsArrayBuffer(c)}else try{g(JSON.stringify(c))}catch(E){console.error("Couldn't convert value into a JSON string: ",c),g(null,E)}}function gs(c){if(c.substring(0,rt)!==Pe)return JSON.parse(c);var g=c.substring(Kt),d=c.substring(rt,Kt),v;if(d===ot&&Pt.test(g)){var w=g.match(Pt);v=w[1],g=g.substring(w[0].length)}var m=Gt(g);switch(d){case lt:return m;case ot:return u([m],{type:v});case Ht:return new Int8Array(m);case Lt:return new Uint8Array(m);case Wt:return new Uint8ClampedArray(m);case Vt:return new Int16Array(m);case Yt:return new Uint16Array(m);case Ut:return new Int32Array(m);case qt:return new Uint32Array(m);case jt:return new Float32Array(m);case Xt:return new Float64Array(m);default:throw new Error("Unkown type: "+d)}}var ct={serialize:us,deserialize:gs,stringToBuffer:Gt,bufferToString:at};function Jt(c,g,d,v){c.executeSql("CREATE TABLE IF NOT EXISTS "+g.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],d,v)}function ps(c){var g=this,d={db:null};if(c)for(var v in c)d[v]=typeof c[v]!="string"?c[v].toString():c[v];var w=new h(function(m,E){try{d.db=openDatabase(d.name,String(d.version),d.description,d.size)}catch(C){return E(C)}d.db.transaction(function(C){Jt(C,d,function(){g._dbInfo=d,m()},function(I,_){E(_)})},E)});return d.serializer=ct,w}function ue(c,g,d,v,w,m){c.executeSql(d,v,w,function(E,C){C.code===C.SYNTAX_ERR?E.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[g.storeName],function(I,_){_.rows.length?m(I,C):Jt(I,g,function(){I.executeSql(d,v,w,m)},m)},m):m(E,C)},m)}function ms(c,g){var d=this;c=x(c);var v=new h(function(w,m){d.ready().then(function(){var E=d._dbInfo;E.db.transaction(function(C){ue(C,E,"SELECT * FROM "+E.storeName+" WHERE key = ? LIMIT 1",[c],function(I,_){var D=_.rows.length?_.rows.item(0).value:null;D&&(D=E.serializer.deserialize(D)),w(D)},function(I,_){m(_)})})}).catch(m)});return p(v,g),v}function vs(c,g){var d=this,v=new h(function(w,m){d.ready().then(function(){var E=d._dbInfo;E.db.transaction(function(C){ue(C,E,"SELECT * FROM "+E.storeName,[],function(I,_){for(var D=_.rows,A=D.length,H=0;H<A;H++){var W=D.item(H),V=W.value;if(V&&(V=E.serializer.deserialize(V)),V=c(V,W.key,H+1),V!==void 0){w(V);return}}w()},function(I,_){m(_)})})}).catch(m)});return p(v,g),v}function Qt(c,g,d,v){var w=this;c=x(c);var m=new h(function(E,C){w.ready().then(function(){g===void 0&&(g=null);var I=g,_=w._dbInfo;_.serializer.serialize(g,function(D,A){A?C(A):_.db.transaction(function(H){ue(H,_,"INSERT OR REPLACE INTO "+_.storeName+" (key, value) VALUES (?, ?)",[c,D],function(){E(I)},function(W,V){C(V)})},function(H){if(H.code===H.QUOTA_ERR){if(v>0){E(Qt.apply(w,[c,I,d,v-1]));return}C(H)}})})}).catch(C)});return p(m,d),m}function ws(c,g,d){return Qt.apply(this,[c,g,d,1])}function bs(c,g){var d=this;c=x(c);var v=new h(function(w,m){d.ready().then(function(){var E=d._dbInfo;E.db.transaction(function(C){ue(C,E,"DELETE FROM "+E.storeName+" WHERE key = ?",[c],function(){w()},function(I,_){m(_)})})}).catch(m)});return p(v,g),v}function ys(c){var g=this,d=new h(function(v,w){g.ready().then(function(){var m=g._dbInfo;m.db.transaction(function(E){ue(E,m,"DELETE FROM "+m.storeName,[],function(){v()},function(C,I){w(I)})})}).catch(w)});return p(d,c),d}function xs(c){var g=this,d=new h(function(v,w){g.ready().then(function(){var m=g._dbInfo;m.db.transaction(function(E){ue(E,m,"SELECT COUNT(key) as c FROM "+m.storeName,[],function(C,I){var _=I.rows.item(0).c;v(_)},function(C,I){w(I)})})}).catch(w)});return p(d,c),d}function Es(c,g){var d=this,v=new h(function(w,m){d.ready().then(function(){var E=d._dbInfo;E.db.transaction(function(C){ue(C,E,"SELECT key FROM "+E.storeName+" WHERE id = ? LIMIT 1",[c+1],function(I,_){var D=_.rows.length?_.rows.item(0).key:null;w(D)},function(I,_){m(_)})})}).catch(m)});return p(v,g),v}function Ss(c){var g=this,d=new h(function(v,w){g.ready().then(function(){var m=g._dbInfo;m.db.transaction(function(E){ue(E,m,"SELECT key FROM "+m.storeName,[],function(C,I){for(var _=[],D=0;D<I.rows.length;D++)_.push(I.rows.item(D).key);v(_)},function(C,I){w(I)})})}).catch(w)});return p(d,c),d}function Cs(c){return new h(function(g,d){c.transaction(function(v){v.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(w,m){for(var E=[],C=0;C<m.rows.length;C++)E.push(m.rows.item(C).name);g({db:c,storeNames:E})},function(w,m){d(m)})},function(v){d(v)})})}function ks(c,g){g=T.apply(this,arguments);var d=this.config();c=typeof c!="function"&&c||{},c.name||(c.name=c.name||d.name,c.storeName=c.storeName||d.storeName);var v=this,w;return c.name?w=new h(function(m){var E;c.name===d.name?E=v._dbInfo.db:E=openDatabase(c.name,"","",0),c.storeName?m({db:E,storeNames:[c.storeName]}):m(Cs(E))}).then(function(m){return new h(function(E,C){m.db.transaction(function(I){function _(W){return new h(function(V,X){I.executeSql("DROP TABLE IF EXISTS "+W,[],function(){V()},function(q,se){X(se)})})}for(var D=[],A=0,H=m.storeNames.length;A<H;A++)D.push(_(m.storeNames[A]));h.all(D).then(function(){E()}).catch(function(W){C(W)})},function(I){C(I)})})}):w=h.reject("Invalid arguments"),p(w,g),w}var Ts={_driver:"webSQLStorage",_initStorage:ps,_support:fs(),iterate:vs,getItem:ms,setItem:ws,removeItem:bs,clear:ys,length:xs,key:Es,keys:Ss,dropInstance:ks};function Is(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ei(c,g){var d=c.name+"/";return c.storeName!==g.storeName&&(d+=c.storeName+"/"),d}function _s(){var c="_localforage_support_test";try{return localStorage.setItem(c,!0),localStorage.removeItem(c),!1}catch{return!0}}function Ds(){return!_s()||localStorage.length>0}function $s(c){var g=this,d={};if(c)for(var v in c)d[v]=c[v];return d.keyPrefix=ei(c,g._defaultConfig),Ds()?(g._dbInfo=d,d.serializer=ct,h.resolve()):h.reject()}function Rs(c){var g=this,d=g.ready().then(function(){for(var v=g._dbInfo.keyPrefix,w=localStorage.length-1;w>=0;w--){var m=localStorage.key(w);m.indexOf(v)===0&&localStorage.removeItem(m)}});return p(d,c),d}function As(c,g){var d=this;c=x(c);var v=d.ready().then(function(){var w=d._dbInfo,m=localStorage.getItem(w.keyPrefix+c);return m&&(m=w.serializer.deserialize(m)),m});return p(v,g),v}function Os(c,g){var d=this,v=d.ready().then(function(){for(var w=d._dbInfo,m=w.keyPrefix,E=m.length,C=localStorage.length,I=1,_=0;_<C;_++){var D=localStorage.key(_);if(D.indexOf(m)===0){var A=localStorage.getItem(D);if(A&&(A=w.serializer.deserialize(A)),A=c(A,D.substring(E),I++),A!==void 0)return A}}});return p(v,g),v}function zs(c,g){var d=this,v=d.ready().then(function(){var w=d._dbInfo,m;try{m=localStorage.key(c)}catch{m=null}return m&&(m=m.substring(w.keyPrefix.length)),m});return p(v,g),v}function Ns(c){var g=this,d=g.ready().then(function(){for(var v=g._dbInfo,w=localStorage.length,m=[],E=0;E<w;E++){var C=localStorage.key(E);C.indexOf(v.keyPrefix)===0&&m.push(C.substring(v.keyPrefix.length))}return m});return p(d,c),d}function Fs(c){var g=this,d=g.keys().then(function(v){return v.length});return p(d,c),d}function Ms(c,g){var d=this;c=x(c);var v=d.ready().then(function(){var w=d._dbInfo;localStorage.removeItem(w.keyPrefix+c)});return p(v,g),v}function Bs(c,g,d){var v=this;c=x(c);var w=v.ready().then(function(){g===void 0&&(g=null);var m=g;return new h(function(E,C){var I=v._dbInfo;I.serializer.serialize(g,function(_,D){if(D)C(D);else try{localStorage.setItem(I.keyPrefix+c,_),E(m)}catch(A){(A.name==="QuotaExceededError"||A.name==="NS_ERROR_DOM_QUOTA_REACHED")&&C(A),C(A)}})})});return p(w,d),w}function Ps(c,g){if(g=T.apply(this,arguments),c=typeof c!="function"&&c||{},!c.name){var d=this.config();c.name=c.name||d.name,c.storeName=c.storeName||d.storeName}var v=this,w;return c.name?w=new h(function(m){c.storeName?m(ei(c,v._defaultConfig)):m(c.name+"/")}).then(function(m){for(var E=localStorage.length-1;E>=0;E--){var C=localStorage.key(E);C.indexOf(m)===0&&localStorage.removeItem(C)}}):w=h.reject("Invalid arguments"),p(w,g),w}var Hs={_driver:"localStorageWrapper",_initStorage:$s,_support:Is(),iterate:Os,getItem:As,setItem:Bs,removeItem:Ms,clear:Rs,length:Fs,key:zs,keys:Ns,dropInstance:Ps},Ls=function(g,d){return g===d||typeof g=="number"&&typeof d=="number"&&isNaN(g)&&isNaN(d)},Ws=function(g,d){for(var v=g.length,w=0;w<v;){if(Ls(g[w],d))return!0;w++}return!1},ti=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"},$e={},ii={},Se={INDEXEDDB:hs,WEBSQL:Ts,LOCALSTORAGE:Hs},Vs=[Se.INDEXEDDB._driver,Se.WEBSQL._driver,Se.LOCALSTORAGE._driver],He=["dropInstance"],ht=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(He),Us={description:"",driver:Vs.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ys(c,g){c[g]=function(){var d=arguments;return c.ready().then(function(){return c[g].apply(c,d)})}}function ft(){for(var c=1;c<arguments.length;c++){var g=arguments[c];if(g)for(var d in g)g.hasOwnProperty(d)&&(ti(g[d])?arguments[0][d]=g[d].slice():arguments[0][d]=g[d])}return arguments[0]}var qs=function(){function c(g){l(this,c);for(var d in Se)if(Se.hasOwnProperty(d)){var v=Se[d],w=v._driver;this[d]=w,$e[w]||this.defineDriver(v)}this._defaultConfig=ft({},Us),this._config=ft({},this._defaultConfig,g),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return c.prototype.config=function(d){if((typeof d>"u"?"undefined":r(d))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var v in d){if(v==="storeName"&&(d[v]=d[v].replace(/\W/g,"_")),v==="version"&&typeof d[v]!="number")return new Error("Database version must be a number.");this._config[v]=d[v]}return"driver"in d&&d.driver?this.setDriver(this._config.driver):!0}else return typeof d=="string"?this._config[d]:this._config},c.prototype.defineDriver=function(d,v,w){var m=new h(function(E,C){try{var I=d._driver,_=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!d._driver){C(_);return}for(var D=ht.concat("_initStorage"),A=0,H=D.length;A<H;A++){var W=D[A],V=!Ws(He,W);if((V||d[W])&&typeof d[W]!="function"){C(_);return}}var X=function(){for(var Re=function(Ks){return function(){var Zs=new Error("Method "+Ks+" is not implemented by the current driver"),si=h.reject(Zs);return p(si,arguments[arguments.length-1]),si}},dt=0,Xs=He.length;dt<Xs;dt++){var ut=He[dt];d[ut]||(d[ut]=Re(ut))}};X();var q=function(Re){$e[I]&&console.info("Redefining LocalForage driver: "+I),$e[I]=d,ii[I]=Re,E()};"_support"in d?d._support&&typeof d._support=="function"?d._support().then(q,C):q(!!d._support):q(!0)}catch(se){C(se)}});return y(m,v,w),m},c.prototype.driver=function(){return this._driver||null},c.prototype.getDriver=function(d,v,w){var m=$e[d]?h.resolve($e[d]):h.reject(new Error("Driver not found."));return y(m,v,w),m},c.prototype.getSerializer=function(d){var v=h.resolve(ct);return y(v,d),v},c.prototype.ready=function(d){var v=this,w=v._driverSet.then(function(){return v._ready===null&&(v._ready=v._initDriver()),v._ready});return y(w,d,d),w},c.prototype.setDriver=function(d,v,w){var m=this;ti(d)||(d=[d]);var E=this._getSupportedDrivers(d);function C(){m._config.driver=m.driver()}function I(A){return m._extend(A),C(),m._ready=m._initStorage(m._config),m._ready}function _(A){return function(){var H=0;function W(){for(;H<A.length;){var V=A[H];return H++,m._dbInfo=null,m._ready=null,m.getDriver(V).then(I).catch(W)}C();var X=new Error("No available storage method found.");return m._driverSet=h.reject(X),m._driverSet}return W()}}var D=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=D.then(function(){var A=E[0];return m._dbInfo=null,m._ready=null,m.getDriver(A).then(function(H){m._driver=H._driver,C(),m._wrapLibraryMethodsWithReady(),m._initDriver=_(E)})}).catch(function(){C();var A=new Error("No available storage method found.");return m._driverSet=h.reject(A),m._driverSet}),y(this._driverSet,v,w),this._driverSet},c.prototype.supports=function(d){return!!ii[d]},c.prototype._extend=function(d){ft(this,d)},c.prototype._getSupportedDrivers=function(d){for(var v=[],w=0,m=d.length;w<m;w++){var E=d[w];this.supports(E)&&v.push(E)}return v},c.prototype._wrapLibraryMethodsWithReady=function(){for(var d=0,v=ht.length;d<v;d++)Ys(this,ht[d])},c.prototype.createInstance=function(d){return new c(d)},c}(),js=new qs;i.exports=js},{3:3}]},{},[4])(4)})})(Gi);var Il=Gi.exports;const Nl=Gs(Il);export{j as C,kl as S,Nl as l};
