/* empty css             */import{u as I,a as T,r as w,C as $,o as q,i as J,m as O,d as j,e as u,f as g,w as V,D as H,E as A}from"./index-763031f0.js";import{l as G}from"./localforage-92bfdfe0.js";const K={class:"preview-page"},L={class:"preview-header"},P={class:"com-header"},Q=u("span",null,"返回",-1),F=Object.assign({name:"qReportView"},{__name:"index",props:{propData:{type:Object,default:()=>({})}},setup(b){const f=b;I();const p=T(),B=(a,n)=>{const o=document.createElement("canvas").getContext("2d"),y=n.font||{name:"Arial",size:10,bold:!1,italic:!1},{size:l,bold:i,italic:r,name:v}=y,t=parseInt(l*window.devicePixelRatio,10);let e="";r&&(e+="italic "),i&&(e+="bold "),e+=`${t}px `,v&&(e+=v),o.font=e;const d=o.measureText(a),x=Math.abs(d.actualBoundingBoxLeft)+Math.abs(d.actualBoundingBoxRight);return Math.max(d.width,x)+4},h=w(),c=w(null),s=w(null),E=()=>{const a=()=>{const{rows:n,styles:_,cols:o,col:y}=s.value;if(!n)return;console.log(111,s.value);const l={},i=[];let r=0;Object.values(n).forEach(t=>{typeof t=="object"&&Object.keys(t.cells).forEach(e=>{const d=t.cells[e],{style:x,text:R,dynamicWidth:k}=d,M=+e;if(r=Math.max(r,M+1),k){i.includes(e)||i.push(e);const S=_[x]||{},W=B(R,S),m=Reflect.get(l,e),z=m?m.width:0,C=Math.max(W,z);m?m.width=C:Reflect.set(l,e,{width:C})}})});const v=Object.keys(n).reduce((t,e)=>isNaN(+e)?t:+e+1,0);i.forEach(t=>{o[t]=l[t]}),s.value.rows.len=v,s.value.cols.len=r,c.value.loadData(s.value),c.value.reRender()};c.value?a():H(()=>{D(),a()})},N=()=>{p.go(-1)},D=()=>{if(c.value)return;const a={mode:"read",showToolbar:!1,showBottomBar:!1,showGrid:!1,showContextmenu:!1,view:{height:()=>h.value.clientHeight,width:()=>h.value.clientWidth},row:{len:0,height:25},col:{len:0,width:100},style:{bgcolor:"#ffffff",align:"left",valign:"middle",textwrap:!1,strike:!1,underline:!1,color:"#0a0a0a",font:{name:"Helvetica",size:10,bold:!1,italic:!1}}};c.value=new x_spreadsheet(h.value,a)};return $(()=>f.propData,a=>{s.value=JSON.parse(JSON.stringify(a)),E()},{immediate:!0}),q(()=>{D()}),(a,n)=>{const _=J("Back"),o=A;return O(),j("div",K,[u("div",L,[u("div",P,[u("div",{class:"back-wrap",onClick:N},[g(o,null,{default:V(()=>[g(_)]),_:1}),Q])])]),u("div",{ref_key:"container",ref:h,class:"q-report-view"},null,512)])}}});const U={class:"preview-wrapper"},ee=Object.assign({name:"preview"},{__name:"index",setup(b){const f=w({});return G.getItem("previewData").then(p=>{f.value=JSON.parse(p)}),(p,B)=>(O(),j("div",U,[g(F,{propData:f.value},null,8,["propData"])]))}});export{ee as default};
